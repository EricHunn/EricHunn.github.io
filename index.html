<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="无心是一首歌" type="application/atom+xml" />






<meta name="description" content="大数据|动漫迷|科技控">
<meta property="og:type" content="website">
<meta property="og:title" content="无心是一首歌">
<meta property="og:url" content="http://erichunn.github.io/index.html">
<meta property="og:site_name" content="无心是一首歌">
<meta property="og:description" content="大数据|动漫迷|科技控">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="无心是一首歌">
<meta name="twitter:description" content="大数据|动漫迷|科技控">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: 'undefined',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://erichunn.github.io/"/>





  <title>无心是一首歌</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?02fe19ac065353167cab1b453f2909ec";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">无心是一首歌</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-首页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-关于我">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于我
          </a>
        </li>
      
        
        <li class="menu-item menu-item-标签">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-分类">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-归档">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-站点地图">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-腾讯公益">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            腾讯公益
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://erichunn.github.io/2019/11/06/Oracle使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Eric Hunn">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="无心是一首歌">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/06/Oracle使用/" itemprop="url">Oracle使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-06T14:18:03+08:00">
                2019-11-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Oracle的查询"><a href="#Oracle的查询" class="headerlink" title="Oracle的查询"></a>Oracle的查询</h1><h2 id="单行查询"><a href="#单行查询" class="headerlink" title="单行查询"></a>单行查询</h2><p>upper代表将小写转换成大写，lower大写变小写<br><img src="https://i.imgur.com/9rodKEr.png" alt=""><br>round四舍五入，后面参数保留几位。trunc直接截取几位。<br><img src="https://i.imgur.com/s5tOMWq.png" alt=""></p>
<p><img src="https://i.imgur.com/xxDaXwf.png" alt=""></p>
<p><img src="https://i.imgur.com/NKM9KU5.png" alt=""></p>
<p>转换函数：<br><img src="https://i.imgur.com/3lGMivQ.png" alt=""><br>通用函数：<br>nvl函数：如果是空的话就按照后面的给定的数值来计算：<br><img src="https://i.imgur.com/D1Zlr9D.png" alt=""></p>
<h2 id="多行函数（聚合函数）"><a href="#多行函数（聚合函数）" class="headerlink" title="多行函数（聚合函数）"></a>多行函数（聚合函数）</h2><p><img src="https://i.imgur.com/ZWGzcWn.png" alt=""></p>
<h2 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h2><p>分组查询中，出现在group by后面的原始列才能出现在select后面 ，没有出现在group by后面的列想在select后面出现必须加上聚合函数，也就是下面的e.sal必须要使用完聚合函数之后才能用。下面这个SQL在经历了group by之后已经变成了三行两列的状况，也就是有几个部门就有几组数据了。所以如果在聚合完了之后的再去查询e.ename，一个部门肯定不止一个人，怎么都没法查询，所以说select后面出现的必须是一个组的共同特性。<br>聚合函数是作用于多列返回一个值，也就是聚合函数有一个特性，可以把多行记录变成一个值。<br><img src="https://i.imgur.com/pZd41xt.png" alt=""></p>
<hr>
<p>如果说把avg(e.sal) 设置一个别名asal那么在写having条件的时候能否直接使用asal&gt;200呢，不行的</p>
<p>所有条件都不能使用别名判断，因为在查询的时候都是分先后顺序的。<br><img src="https://i.imgur.com/vs8YqkY.png" alt=""></p>
<hr>
<p>说一个错误的案例<br><img src="https://i.imgur.com/KazK8Dz.png" alt=""></p>
<hr>
<p><img src="https://i.imgur.com/4A7O1hp.png" alt=""></p>
<p><img src="https://i.imgur.com/oa1LRqq.png" alt=""></p>
<hr>
<h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><p><img src="https://i.imgur.com/pRhtP3Z.png" alt=""></p>
<p>内连接和等值连接一样</p>
<p><img src="https://i.imgur.com/9PJPFNT.png" alt=""></p>
<p><img src="https://i.imgur.com/ER5WivO.png" alt=""></p>
<p><img src="https://i.imgur.com/xH8YnZX.png" alt=""></p>
<h3 id="左外连接和右外连接的区别"><a href="#左外连接和右外连接的区别" class="headerlink" title="左外连接和右外连接的区别"></a>左外连接和右外连接的区别</h3><p><img src="https://i.imgur.com/39ZdRfn.png" alt=""></p>
<h3 id="oracle中专用连接"><a href="#oracle中专用连接" class="headerlink" title="oracle中专用连接"></a>oracle中专用连接</h3><p><img src="https://i.imgur.com/4XxzU1B.png" alt=""></p>
<hr>
<h3 id="继续多表查询"><a href="#继续多表查询" class="headerlink" title="继续多表查询"></a>继续多表查询</h3><p>首先如果写一个复杂的查询先把架子搭起来，也就是：</p>
<p>select </p>
<p>from </p>
<p>where</p>
<p>然后在继续往里面写<br><img src="https://i.imgur.com/hL5Scyy.png" alt=""></p>
<p>首先看上面这张图，要写这个SQL首先考虑员工在哪一张表，领导姓名在哪张表，然后放在from后面</p>
<p>首先这个数据库下EMP表可以看到多个信息，可以看见员工也可以看见这个员工对应的领导</p>
<h3 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h3><p><img src="https://i.imgur.com/Rt47x0M.png" alt=""><br>其中mgr是领导编号，empno是员工编号</p>
<h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><p>下面这个查询的前提是这个ename是主键，也就是唯一可以写等号<br><img src="https://i.imgur.com/gDwL9BT.png" alt=""></p>
<p>要不然下面这种写法比较准确</p>
<p><img src="https://i.imgur.com/Wc2Ovse.png" alt=""></p>
<hr>
<p><img src="https://i.imgur.com/7LZ8JtO.png" alt=""></p>
<hr>
<p><img src="https://i.imgur.com/c5IfG9S.png" alt=""></p>
<h2 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h2><p><img src="https://i.imgur.com/rGa4WDi.png" alt=""></p>
<p>这个分页查询的仔细解释，涉及到一个rownum的问题。</p>
<p>首先看下面这样一个错误的案例：下面这个错误的案例的原因是由于顺序的问题首先是select 的内容，做完之后rownum就是在select之后就排序了，这个rownum也就相当于一个独立于这个表之外的一个列的感觉。这样的话然后再去使用where条件的话rownum已经是乱序的了，所以，这样的话是拿不到前几个的</p>
<p><img src="https://i.imgur.com/VJc7HGK.png" alt=""></p>
<p>那么rownum乱序怎么理解呢？看如下图，也就是说上面的where条件是在下面这种情况下加上的。</p>
<p><img src="https://i.imgur.com/Ik1OhOt.png" alt=""></p>
<p>所以得出来一个结论，也就是排序操作会影响rownum的顺序，我们可以先排序在去加行号。</p>
<p><img src="https://i.imgur.com/vRYDkdp.png" alt=""></p>
<p>这样就已经不乱了。</p>
<p>也就是说如果涉及到排序，但是还需要使用rownum的话，我们可以再次嵌套查询，就可以避开rownum乱的顺序了。</p>
<p>接着来说分页查询的一个失败的案例</p>
<p><img src="https://i.imgur.com/9AJibTN.png" alt=""></p>
<p>看上面的这个发现这样子查询出来就一条数据都没有了，什么原因呢</p>
<p>原因就是因为rownum是在select之后按照顺序排列的，rownum是按照顺序依次递增不能跳着顺序走。那么这句SQL就设计到一个问题，也就是select先执行还是where先执行的问题。我们知道是where先走，当where先的时候，查询第一条记录本来要在该记录上加上一个行号1但是一看要通过rownum=1来判断rownum&gt;5的条件，这样一来怎么都不能满足，第一个rownum就加不上，也不能跳跃着加，所以就查不到了，只不过是条件不满足而已。</p>
<p>所以rownum不能直接写大于一个正数，但是我们可以通过嵌套间接写大于也就是如下</p>
<p><img src="https://i.imgur.com/T7okHNi.png" alt=""></p>
<p>分页查询结束</p>
<hr>
<hr>
<hr>
<h1 id="Oracle的对象"><a href="#Oracle的对象" class="headerlink" title="Oracle的对象"></a>Oracle的对象</h1><h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p><img src="https://i.imgur.com/RTT3Y5W.png" alt=""></p>
<p><img src="https://i.imgur.com/ZKixbfN.png" alt=""></p>
<p><img src="https://i.imgur.com/LNbrv3z.png" alt=""></p>
<p>假如总部一个查询语句，分部一个查询语句各自查一套，总部突然卖出了十万雨伞，但是分部没有及时去查询，就出现总部已经没货了，所以就让总部从表中查询，分部看视图，因为视图里面根本就没数据，只要总部的数据改变了，分部立马就能看到最新的数据。这是视图经常使用的地方。</p>
<hr>
<hr>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p><img src="https://i.imgur.com/oEGbq9z.png" alt=""></p>
<p><img src="https://i.imgur.com/dgIVAcY.png" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://erichunn.github.io/2019/11/03/SpringMVC第二天/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Eric Hunn">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="无心是一首歌">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/03/SpringMVC第二天/" itemprop="url">SpringMVC第二天</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-03T21:06:07+08:00">
                2019-11-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="第一章：相应数据和结果视图"><a href="#第一章：相应数据和结果视图" class="headerlink" title="第一章：相应数据和结果视图"></a>第一章：相应数据和结果视图</h1><h2 id="响应之返回值是String类型的"><a href="#响应之返回值是String类型的" class="headerlink" title="响应之返回值是String类型的"></a>响应之返回值是String类型的</h2><blockquote>
<p>首先说一个以后开发常见的方式：<br>首先从response.jsp发请求，然后我从Controller后台查出来，存到model，存到request里，然后在转发到页面。再从request域里取出来。</p>
</blockquote>
<pre><code>package cn.itcast.controller;

import cn.itcast.domain.User;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;

/**
 * @Description TODO
 * @Author TT Hun
 * @Data 2019/11/3 21:26
 */
@Controller
@RequestMapping(&quot;/user&quot;)
public class UserController {

    @RequestMapping(&quot;/testString&quot;)
    public String testString(Model model){
        System.out.println(&quot;testString方法执行了...&quot;);
//       模拟从数据库中查询对象
        User user = new User();
        user.setUsername(&quot;美美&quot;);
        user.setPassword(&quot;123&quot;);
        user.setAge(30);
//        把对象存起来
        model.addAttribute(&quot;user&quot;,user);
        return &quot;success&quot;;
    }

}
</code></pre><hr>
<pre><code>package cn.itcast.domain;

import java.io.Serializable;

/**
 * @Description TODO
 * @Author TT Hun
 * @Data 2019/11/3 22:00
 */
public class User  implements Serializable {
    private String password;
    private Integer age;
    private String  username;

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }
}
</code></pre><hr>
<p>springmvc.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;!-- 开启注解扫描 扫描这个路径下的包，就可以在--&gt;
    &lt;context:component-scan base-package=&quot;cn.itcast&quot;/&gt;

    &lt;!-- 视图解析器对象  视图解析器的类名是固定的，然后配置通过这个视图解析器就可以让controller里面return的东西直接跳转指定的jsp页面
        但是还需要配置2个属性，一个是Prefix就是配置找文件的路径
        suffix指的是配置的后缀名字。最后也就是找/web-if/pages/下的后缀是jsp的文件--&gt;
    &lt;bean id=&quot;internalResourceViewResolver&quot; class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/pages/&quot;/&gt;
        &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;
    &lt;/bean&gt;

    &lt;!-- 开启SpringMVC框架注解的支持 标签是固定的--&gt;
    &lt;mvc:annotation-driven  /&gt;

&lt;/beans&gt;
</code></pre><hr>
<p>success.jsp</p>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/3
  Time: 21:22
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; isELIgnored=&quot;false&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h2&gt;执行成功&lt;/h2&gt;

${user.username}
${user.password}

&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<p>web.xml</p>
<pre><code>&lt;!DOCTYPE web-app PUBLIC
 &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;
 &quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot; &gt;

&lt;web-app&gt;
  &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;

  &lt;!--配置前端控制器--&gt;
  &lt;servlet&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
      &lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
  &lt;/servlet&gt;

  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;

  &lt;!--配置解决中文乱码的过滤器--&gt;
  &lt;filter&gt;
    &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;encoding&lt;/param-name&gt;
      &lt;param-value&gt;UTF-8&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/filter&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;

&lt;/web-app&gt;
</code></pre><hr>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/3
  Time: 21:25
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;a href=&quot;user/testString&quot; &gt;testString&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<hr>
<hr>
<h2 id="响应值值返回值是void类型"><a href="#响应值值返回值是void类型" class="headerlink" title="响应值值返回值是void类型"></a>响应值值返回值是void类型</h2><h3 id="第一种方法：编写请求转发程序跳转到jsp界面"><a href="#第一种方法：编写请求转发程序跳转到jsp界面" class="headerlink" title="第一种方法：编写请求转发程序跳转到jsp界面"></a>第一种方法：编写请求转发程序跳转到jsp界面</h3><pre><code>package cn.itcast.controller;

import cn.itcast.domain.User;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * @Description TODO
 * @Author TT Hun
 * @Data 2019/11/3 21:26
 */
@Controller
@RequestMapping(&quot;/user&quot;)
public class UserController {

    /**
     * 返回值类型是一个字符串
     * @param model
     * @return
     */
    @RequestMapping(&quot;/testString&quot;)
    public String testString(Model model){
        System.out.println(&quot;testString方法执行了...&quot;);
//       模拟从数据库中查询对象
        User user = new User();
        user.setUsername(&quot;美美&quot;);
        user.setPassword(&quot;123&quot;);
        user.setAge(30);
//        把对象存起来
        model.addAttribute(&quot;user&quot;,user);
        return &quot;success&quot;;
    }


    /**
     * 返回值类型是Void
     * 请求转发是一次请求，请求路径不用编写项目名字
     * @param
     * @return
     */
    @RequestMapping(&quot;/testVoid&quot;)
    public void testVoid(HttpServletRequest request ,HttpServletResponse response)throws  Exception{
        System.out.println(&quot;testVoid方法执行了...&quot;);
//       便携请求转发的程序，手动便携转发程序不会通过视图解析器，所以要自己配置WEB-INF/pages/success.jsp需要自己提供完整目录
        request.getRequestDispatcher(&quot;/WEB-INF/pages/success.jsp&quot;).forward(request,response);

        return ;
    }
}
</code></pre><hr>
<pre><code>package cn.itcast.domain;

import java.io.Serializable;

/**
 * @Description TODO
 * @Author TT Hun
 * @Data 2019/11/3 22:00
 */
public class User  implements Serializable {
    private String password;
    private Integer age;
    private String  username;

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }
}
</code></pre><hr>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/3
  Time: 21:25
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;a href=&quot;user/testString&quot; &gt;testString&lt;/a&gt;
&lt;br&gt;
&lt;a href=&quot;user/testVoid&quot;&gt;testVoid&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<p>success.jsp</p>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/3
  Time: 21:22
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; isELIgnored=&quot;false&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h2&gt;执行成功&lt;/h2&gt;

${user.username}
${user.password}

&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<h3 id="第二种方法：重定向"><a href="#第二种方法：重定向" class="headerlink" title="第二种方法：重定向"></a>第二种方法：重定向</h3><p><img src="https://i.imgur.com/JKmwTno.png" alt=""></p>
<h3 id="第三种方法：直接响应"><a href="#第三种方法：直接响应" class="headerlink" title="第三种方法：直接响应"></a>第三种方法：直接响应</h3><p><img src="https://i.imgur.com/nqn2Zb5.png" alt=""></p>
<hr>
<h2 id="响应之返回值是ModelAndView类型"><a href="#响应之返回值是ModelAndView类型" class="headerlink" title="响应之返回值是ModelAndView类型"></a>响应之返回值是ModelAndView类型</h2><p>这个和返回值是String基本是一样的，只不过写法不同，返回值String底层也是调用这个的。<br><img src="https://i.imgur.com/cRzAOZk.png" alt=""></p>
<h2 id="转发和重定向"><a href="#转发和重定向" class="headerlink" title="转发和重定向"></a>转发和重定向</h2><p>有个问题没搞懂，重定向智能定位到根目录下的文件吗。为什么写和上面一样的路径不能跳转。是一个问题，尚未认真考虑解决呢。<br><img src="https://i.imgur.com/3qS26c7.png" alt=""></p>
<h2 id="ResponseBody注解响应json数据"><a href="#ResponseBody注解响应json数据" class="headerlink" title="ResponseBody注解响应json数据"></a>ResponseBody注解响应json数据</h2><p>页面发送一个axis请求，是一个异步请求，后台需要把对象转换成json的字符串响应回去可以通过ResponseBody这个注解完成这个任务。</p>
<p>这个地方需要告诉前端控制器不是所有请求都拦截的，静态资源比如.js和图片是不需要拦截的。下面这地方配置为/证明都拦截还需要在springmvc.xml中配置哪些不拦截<br><img src="https://i.imgur.com/R7peaUO.png" alt=""><br><img src="https://i.imgur.com/2pkeXim.png" alt=""></p>
<p>先看目录结构：<br><img src="https://i.imgur.com/DqJvvYs.png" alt="">里面的js文件视频中是从资料中直接拿到的。</p>
<p>下面是整个代码的结构：</p>
<p><img src="https://i.imgur.com/XvHH7N4.png" alt=""></p>
<p>response.jsp界面</p>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/3
  Time: 21:25
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
    &lt;%--下面这个是吧js引入到了jsp里面了--%&gt;
    &lt;script src=&quot;js/jquery.min.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
        // 页面加载，绑定点击时间
        $(function(){
            $(&quot;#btn&quot;).click(function(){
                 alert(&quot;hello btn&quot;);
            });
        });
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;a href=&quot;user/testString&quot; &gt;testString&lt;/a&gt;
&lt;br&gt;
&lt;a href=&quot;user/testVoid&quot;&gt;testVoid&lt;/a&gt;
5&lt;br&gt;
&lt;%--转发或者重定向--%&gt;
&lt;a href=&quot;user/testForwardOrRedirect&quot;&gt;testForwardOrRedirect&lt;/a&gt;

&lt;%--写一个按钮--%&gt;
&lt;button id=&quot;btn&quot;&gt;发送ajax的请求&lt;/button&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<p>在springmvc.xml文件中设置哪些不拦截；</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;!-- 开启注解扫描 扫描这个路径下的包，就可以在--&gt;
    &lt;context:component-scan base-package=&quot;cn.itcast&quot;/&gt;

    &lt;!-- 视图解析器对象  视图解析器的类名是固定的，然后配置通过这个视图解析器就可以让controller里面return的东西直接跳转指定的jsp页面
        但是还需要配置2个属性，一个是Prefix就是配置找文件的路径
        suffix指的是配置的后缀名字。最后也就是找/web-if/pages/下的后缀是jsp的文件--&gt;
    &lt;bean id=&quot;internalResourceViewResolver&quot; class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/pages/&quot;/&gt;
        &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;
    &lt;/bean&gt;

&lt;!--前端控制器，哪些静态资源不拦截，location写法就是以后js下所有的请求都不拦截，mapping就是和映射请求有关的,以后jss-图片也需要配置上不拦截--&gt;
    &lt;mvc:resources mapping=&quot;/js/&quot; location=&quot;/js/**&quot;/&gt;


&lt;!--     开启SpringMVC框架注解的支持 标签是固定的--&gt;
    &lt;mvc:annotation-driven  /&gt;

&lt;/beans&gt;
</code></pre><hr>
<h2 id="响应json数据之发送ajax请求"><a href="#响应json数据之发送ajax请求" class="headerlink" title="响应json数据之发送ajax请求"></a>响应json数据之发送ajax请求</h2><p>package cn.itcast.controller;</p>
<p>import cn.itcast.domain.User;<br>import org.springframework.stereotype.Controller;<br>import org.springframework.ui.Model;<br>import org.springframework.web.bind.annotation.RequestBody;<br>import org.springframework.web.bind.annotation.RequestMapping;<br>import org.springframework.web.servlet.ModelAndView;</p>
<p>import javax.servlet.http.HttpServletRequest;<br>import javax.servlet.http.HttpServletResponse;</p>
<p>/**</p>
<ul>
<li>@Description TODO</li>
<li>@Author TT Hun</li>
<li><p>@Data 2019/11/3 21:26<br>*/<br>@Controller<br>@RequestMapping(“/user”)<br>public class UserController {</p>
<p> /**</p>
<ul>
<li>模拟异步请求和响应过程</li>
<li>@param</li>
<li>@return<br>*/<br>@RequestMapping(“/testAjax”)<br>public void testAjax(@RequestBody String body){<br> System.out.println(“testForwardOrRedirect开始执行”);<br> System.out.println(body);<br>}<br>}</li>
</ul>
</li>
</ul>
<hr>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/3
  Time: 21:25
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
    &lt;%--下面这个是吧js引入到了jsp里面了--%&gt;
    &lt;script src=&quot;js/jquery.min.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
        // 页面加载，绑定点击时间
        $(function(){
            $(&quot;#btn&quot;).click(function(){
                 // alert(&quot;hello btn&quot;);
            //    发送ajax请求
                $.ajax({
                //    编写json格式
                    url:&quot;user/testAjax&quot;,
                    //给服务器端传递的类型
                    contentType:&quot;application/json;charset=utf-8&quot;,
                    data:&apos;{&quot;username&quot;:&quot;呵呵&quot;,&quot;password&quot;:&quot;123&quot;,&quot;age&quot;:&quot;30&quot;}&apos;,
                    dataType:&quot;json&quot;,
                    type:&quot;post&quot;,
                    success:function (data){
                //        data指的是服务器端Json相应的数据，进行解析

                }
                })
            });

        });
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;a href=&quot;user/testString&quot; &gt;testString&lt;/a&gt;
&lt;br&gt;
&lt;a href=&quot;user/testVoid&quot;&gt;testVoid&lt;/a&gt;
5&lt;br&gt;
&lt;%--转发或者重定向--%&gt;
&lt;a href=&quot;user/testForwardOrRedirect&quot;&gt;testForwardOrRedirect&lt;/a&gt;

&lt;%--写一个按钮--%&gt;
&lt;button id=&quot;btn&quot;&gt;发送ajax的请求&lt;/button&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<p>结果直接拿到请求体<br><img src="https://i.imgur.com/Fm5iLrw.png" alt=""></p>
<hr>
<h3 id="怎么返回的json数据直接封装到对象当中"><a href="#怎么返回的json数据直接封装到对象当中" class="headerlink" title="怎么返回的json数据直接封装到对象当中"></a>怎么返回的json数据直接封装到对象当中</h3><p> springmvc框架已经帮我们做好了很多，如果Key和javabean中属性相同，可以直接封装到javabean里面，但是需要额外的jar包做类型转换。把串转成对象或者把对象转成串。</p>
<pre><code>package cn.itcast.controller;

import cn.itcast.domain.User;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.ModelAndView;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * @Description TODO
 * @Author TT Hun
 * @Data 2019/11/3 21:26
 */
@Controller
@RequestMapping(&quot;/user&quot;)
public class UserController {

    @RequestMapping(&quot;/testAjax&quot;)
    public @ResponseBody User testAjax(@RequestBody User user){
        System.out.println(&quot;testAjax开始执行&quot;);
//       客户端发送的ajax请求，传递的是json字符串，后台已经把字符串封装到user对象当中去了
        System.out.println(user);
//        做一个响应
        user.setUsername(&quot;哈哈&quot;);
        user.setAge(40);
        user.setPassword(&quot;123&quot;);
        return user;
    }
}
</code></pre><hr>
<pre><code>package cn.itcast.domain;

import java.io.Serializable;

/**
 * @Description TODO
 * @Author TT Hun
 * @Data 2019/11/3 22:00
 */
public class User  implements Serializable {
    private String password;
    private Integer age;
    private String  username;

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    @Override
    public String toString() {
        return &quot;User{&quot; +
                &quot;password=&apos;&quot; + password + &apos;\&apos;&apos; +
                &quot;, age=&quot; + age +
                &quot;, username=&apos;&quot; + username + &apos;\&apos;&apos; +
                &apos;}&apos;;
    }
}
</code></pre><hr>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/3
  Time: 21:25
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
    &lt;%--下面这个是吧js引入到了jsp里面了--%&gt;
    &lt;script src=&quot;js/jquery.min.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
        // 页面加载，绑定点击时间
        $(function(){
            $(&quot;#btn&quot;).click(function(){
                 // alert(&quot;hello btn&quot;);
            //    发送ajax请求
                $.ajax({
                //    编写json格式
                    url:&quot;user/testAjax&quot;,
                    //给服务器端传递的类型
                    contentType:&quot;application/json;charset=utf-8&quot;,
                    data:&apos;{&quot;username&quot;:&quot;呵呵&quot;,&quot;password&quot;:&quot;123&quot;,&quot;age&quot;:&quot;30&quot;}&apos;,
                    dataType:&quot;json&quot;,
                    type:&quot;post&quot;,
                    success:function (data){
                //        data指的是服务器端Json相应的数据，进行解析
                    alert(data);
                    alert(data.username);
                    alert(data.age);
                    alert(data.password);
                }
                })
            });

        });
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;a href=&quot;user/testString&quot; &gt;testString&lt;/a&gt;
&lt;br&gt;
&lt;a href=&quot;user/testVoid&quot;&gt;testVoid&lt;/a&gt;
5&lt;br&gt;
&lt;%--转发或者重定向--%&gt;
&lt;a href=&quot;user/testForwardOrRedirect&quot;&gt;testForwardOrRedirect&lt;/a&gt;

&lt;%--写一个按钮--%&gt;
&lt;button id=&quot;btn&quot;&gt;发送ajax的请求&lt;/button&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<p><img src="https://i.imgur.com/qJnIJQ4.png" alt=""></p>
<h1 id="第二章：SpringMVC实现文件上传"><a href="#第二章：SpringMVC实现文件上传" class="headerlink" title="第二章：SpringMVC实现文件上传"></a>第二章：SpringMVC实现文件上传</h1><h2 id="文件上传回顾"><a href="#文件上传回顾" class="headerlink" title="文件上传回顾"></a>文件上传回顾</h2><p>默认表单提交数据的格式是一组键值对的方式username=hehe&amp;password=123但是一旦把取值从默认变成multipart会把提交的表单分成几个部分，里面存储数据，可能包含文本框的值也可能包含上传选择文件的内容。<br><img src="https://i.imgur.com/3UI4KKM.png" alt=""></p>
<p>然后请求正文的内容变成：<br><img src="https://i.imgur.com/WUaN9Pk.png" alt=""><br><img src="https://i.imgur.com/koETv8W.png" alt=""></p>
<p>这时候表单用分隔符的方式把它分成了若干个部分。那么怎么去解析呢？通过一个jar包的组件<br><img src="https://i.imgur.com/eZ3Pu31.png" alt=""></p>
<hr>
<h2 id="首先环境搭建"><a href="#首先环境搭建" class="headerlink" title="首先环境搭建"></a>首先环境搭建</h2><p>配置springmvc.xml配置web.xml配置Pom.xml</p>
<pre><code>    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!-- $Id: pom.xml 642118 2008-03-28 08:04:16Z reinhard $ --&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;

  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;packaging&gt;war&lt;/packaging&gt;

  &lt;name&gt;springmvc_day02_02_fileupload&lt;/name&gt;
  &lt;groupId&gt;cn.itcast&lt;/groupId&gt;
  &lt;artifactId&gt;springmvc_day02_02_fileupload&lt;/artifactId&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

  &lt;properties&gt;
    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
    &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
    &lt;spring.version&gt;5.0.2.RELEASE&lt;/spring.version&gt;
  &lt;/properties&gt;
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.mortbay.jetty&lt;/groupId&gt;
        &lt;artifactId&gt;maven-jetty-plugin&lt;/artifactId&gt;
        &lt;version&gt;6.1.7&lt;/version&gt;
        &lt;configuration&gt;
          &lt;connectors&gt;
            &lt;connector implementation=&quot;org.mortbay.jetty.nio.SelectChannelConnector&quot;&gt;
              &lt;port&gt;8888&lt;/port&gt;
              &lt;maxIdleTime&gt;30000&lt;/maxIdleTime&gt;
            &lt;/connector&gt;
          &lt;/connectors&gt;
          &lt;webAppSourceDirectory&gt;${project.build.directory}/${pom.artifactId}-${pom.version}&lt;/webAppSourceDirectory&gt;
          &lt;contextPath&gt;/&lt;/contextPath&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
      &lt;version&gt;${spring.version}&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-web&lt;/artifactId&gt;
      &lt;version&gt;${spring.version}&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
      &lt;version&gt;${spring.version}&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
      &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
      &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
      &lt;version&gt;2.5&lt;/version&gt;
      &lt;scope&gt;provided&lt;/scope&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
      &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;
      &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;
      &lt;version&gt;1.3.1&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;commons-io&lt;/groupId&gt;
      &lt;artifactId&gt;commons-io&lt;/artifactId&gt;
      &lt;version&gt;2.4&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
      &lt;groupId&gt;javax.servlet.jsp&lt;/groupId&gt;
      &lt;artifactId&gt;jsp-api&lt;/artifactId&gt;
      &lt;version&gt;2.0&lt;/version&gt;
      &lt;scope&gt;provided&lt;/scope&gt;
    &lt;/dependency&gt;

  &lt;/dependencies&gt;

&lt;/project&gt;
</code></pre><hr>
<p>web.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;web-app version=&quot;2.4&quot;
         xmlns=&quot;http://java.sun.com/xml/ns/j2ee&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot;&gt;


  &lt;!--配置前端控制器--&gt;
  &lt;servlet&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
      &lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
  &lt;/servlet&gt;

  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;

  &lt;!--配置解决中文乱码的过滤器--&gt;
  &lt;filter&gt;
    &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;encoding&lt;/param-name&gt;
      &lt;param-value&gt;UTF-8&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/filter&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
&lt;/web-app&gt;
</code></pre><hr>
<p>springmvc.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;!-- 开启注解扫描 扫描这个路径下的包，就可以在--&gt;
    &lt;context:component-scan base-package=&quot;cn.itcast&quot;/&gt;

    &lt;!-- 视图解析器对象  视图解析器的类名是固定的，然后配置通过这个视图解析器就可以让controller里面return的东西直接跳转指定的jsp页面
        但是还需要配置2个属性，一个是Prefix就是配置找文件的路径
        suffix指的是配置的后缀名字。最后也就是找/web-if/pages/下的后缀是jsp的文件--&gt;
    &lt;bean id=&quot;internalResourceViewResolver&quot; class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/pages/&quot;/&gt;
        &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;
    &lt;/bean&gt;

&lt;!--前端控制器，哪些静态资源不拦截，location写法就是以后js下所有的请求都不拦截，mapping就是和映射请求有关的,以后jss-图片也需要配置上不拦截--&gt;
    &lt;mvc:resources mapping=&quot;/js/&quot; location=&quot;/js/**&quot;/&gt;


&lt;!--     开启SpringMVC框架注解的支持 标签是固定的--&gt;
    &lt;mvc:annotation-driven  /&gt;

&lt;/beans&gt;
</code></pre><hr>
<h2 id="文件上传之传统方式上传代码"><a href="#文件上传之传统方式上传代码" class="headerlink" title="文件上传之传统方式上传代码"></a>文件上传之传统方式上传代码</h2><p>index.jsp文件：<br>    &lt;%–<br>      Created by IntelliJ IDEA.<br>      User: Hun<br>      Date: 2019/11/5<br>      Time: 11:25<br>      To change this template use File | Settings | File Templates.<br>    –%&gt;<br>    &lt;%@ page contentType=”text/html;charset=UTF-8” language=”java” %&gt;<br>    <html><br>    <head><br>        <title>文件上传</title><br>    </head><br>    <body><br>    <h3>文件上传</h3><br>    <form action="user/fileupload1" method="post" enctype="multipart/form-data"><br>        选择上传文件：<input type="file" name="upload"><br>        <br><br>        <input type="submit" value="上传"><br>    </form><br>    </body><br>    </html></p>
<hr>
<p>success.jsp<br>    &lt;%–<br>      Created by IntelliJ IDEA.<br>      User: Hun<br>      Date: 2019/11/5<br>      Time: 11:28<br>      To change this template use File | Settings | File Templates.<br>    –%&gt;<br>    &lt;%@ page contentType=”text/html;charset=UTF-8” language=”java” %&gt;<br>    <html><br>    <head><br>        <title>Title</title><br>    </head><br>    <body><br>    <h3>上传文件成功</h3><br>    </body><br>    </html></p>
<hr>
<pre><code>package cn.itcast.controller;

import org.apache.commons.fileupload.FileItem;
import org.apache.commons.fileupload.disk.DiskFileItemFactory;
import org.apache.commons.fileupload.servlet.ServletFileUpload;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

import javax.servlet.http.HttpServletRequest;
import java.io.File;
import java.util.List;
import java.util.UUID;

/**
 * @Description TODO
 * @Author TT Hun
 * @Data 2019/11/5 11:26
 */
@Controller
@RequestMapping(&quot;/user&quot;)
public class UserController {

    /**
     * 文件上传
     * @return
     */
    @RequestMapping(&quot;/fileupload1&quot;)
    public String fileUpload1(HttpServletRequest request) throws Exception{
        System.out.println(&quot;文件上传&quot;);
//        可以使用fileupload这个组件完成上传
//        上传的位置
        String path = request.getSession().getServletContext().getRealPath(&quot;/uploads/&quot;);
//        判断改路径是否存在：
        File file = new File(path);
        if(!file.exists()){
            file.mkdirs();
        }
//    解析request对象获取到上传的文件项
        DiskFileItemFactory factory=new DiskFileItemFactory();
        ServletFileUpload upload = new ServletFileUpload(factory);
//   解析request
        List&lt;FileItem&gt; items = upload.parseRequest(request);
//        遍历
        for(FileItem item:items){
//            进行判断，判断item对象是否是上传文件项目
            if(item.isFormField()){
//                如果是true则是普通表单项目，如果是false则是上传文件项
            }else{
//                说明是上传文件项
//                 获取到上传文件的名称
                String filename = item.getName();
//                把文件名设置成唯一值，uuid
                String uuid = UUID.randomUUID().toString().replace(&quot;-&quot;,&quot;&quot;);
                filename = uuid+&quot;_&quot;+filename;
//                完成文件上传
                item.write(new File(path,filename));
//                删除临时文件。一旦大于10KB就生成临时文件
                item.delete();


            }
        }

        return &quot;success&quot;;
    }
}
</code></pre><hr>
<p>最终结果的图片落在这里：<br><img src="https://i.imgur.com/k0zwX9f.png" alt=""></p>
<h2 id="SpringMVC上传文件"><a href="#SpringMVC上传文件" class="headerlink" title="SpringMVC上传文件"></a>SpringMVC上传文件</h2><p>首先看一下整体原理：<br>解释一下下面的图：也就是上传的文件通过写在域里面通过request传递到前端控制器，前端控制器通过配置好的文件解析器解析request,然后拿到上传文件。再传递给Controller里面和文件解析器中相同参数名的参数。然后再调用他的方法对他进行使用。<br><img src="https://i.imgur.com/7edLiOL.png" alt=""><br><strong>完整代码如下：</strong><br> Controller</p>
<pre><code>package cn.itcast.controller;

import org.apache.commons.fileupload.FileItem;
import org.apache.commons.fileupload.disk.DiskFileItemFactory;
import org.apache.commons.fileupload.servlet.ServletFileUpload;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.multipart.MultipartFile;

import javax.servlet.http.HttpServletRequest;
import java.io.File;
import java.util.List;
import java.util.UUID;

/**
 * @Description TODO
 * @Author TT Hun
 * @Data 2019/11/5 11:26
 */
@Controller
@RequestMapping(&quot;/user&quot;)
public class UserController {

    /**
     * 传统方式文件上传
     * @return
     */
    @RequestMapping(&quot;/fileupload1&quot;)
    public String fileUpload1(HttpServletRequest request) throws Exception{
        System.out.println(&quot;文件上传&quot;);
//        可以使用fileupload这个组件完成上传
//        上传的位置
        String path = request.getSession().getServletContext().getRealPath(&quot;/uploads/&quot;);
//        判断改路径是否存在：
        File file = new File(path);
        if(!file.exists()){
            file.mkdirs();
        }
//    解析request对象获取到上传的文件项
        DiskFileItemFactory factory=new DiskFileItemFactory();
        ServletFileUpload upload = new ServletFileUpload(factory);
//   解析request
        List&lt;FileItem&gt; items = upload.parseRequest(request);
//        遍历
        for(FileItem item:items){
//            进行判断，判断item对象是否是上传文件项目
            if(item.isFormField()){
//                如果是true则是普通表单项目，如果是false则是上传文件项
            }else{
//                说明是上传文件项
//                 获取到上传文件的名称
                String filename = item.getName();
//                把文件名设置成唯一值，uuid
                String uuid = UUID.randomUUID().toString().replace(&quot;-&quot;,&quot;&quot;);
                filename = uuid+&quot;_&quot;+filename;
//                完成文件上传
                item.write(new File(path,filename));
//                删除临时文件。一旦大于10KB就生成临时文件
                item.delete();
            }
        }
        return &quot;success&quot;;
    }

    /**
     * SpringMVC方式文件上传
     * @return
     */
    @RequestMapping(&quot;/fileupload2&quot;)
    public String fileUpload2(HttpServletRequest request ,MultipartFile upload) throws Exception{
        System.out.println(&quot;文件上传&quot;);
//        可以使用fileupload这个组件完成上传
//        上传的位置
        String path = request.getSession().getServletContext().getRealPath(&quot;/uploads/&quot;);
//        判断改路径是否存在：
        File file = new File(path);
        if(!file.exists()){
            file.mkdirs();
        }
//         说明是上传文件项
//         获取到上传文件的名称
        String filename = upload.getOriginalFilename();
//         把文件名设置成唯一值，uuid
         String uuid = UUID.randomUUID().toString().replace(&quot;-&quot;,&quot;&quot;);
         filename = uuid+&quot;_&quot;+filename;
//         完成文件上传
        upload.transferTo(new File(path,filename));
        return &quot;success&quot;;
    }
}
</code></pre><hr>
<p>springmvc.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;!-- 开启注解扫描 扫描这个路径下的包，就可以在--&gt;
    &lt;context:component-scan base-package=&quot;cn.itcast&quot;/&gt;

    &lt;!-- 视图解析器对象  视图解析器的类名是固定的，然后配置通过这个视图解析器就可以让controller里面return的东西直接跳转指定的jsp页面
        但是还需要配置2个属性，一个是Prefix就是配置找文件的路径
        suffix指的是配置的后缀名字。最后也就是找/web-if/pages/下的后缀是jsp的文件--&gt;
    &lt;bean id=&quot;internalResourceViewResolver&quot; class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/pages/&quot;/&gt;
        &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;
    &lt;/bean&gt;

&lt;!--前端控制器，哪些静态资源不拦截，location写法就是以后js下所有的请求都不拦截，mapping就是和映射请求有关的,以后jss-图片也需要配置上不拦截--&gt;
    &lt;mvc:resources mapping=&quot;/js/&quot; location=&quot;/js/**&quot;/&gt;

&lt;!--    配置文件解析器对象--&gt;
    &lt;bean id=&quot;multipartResolver&quot; class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;&gt;
&lt;!--        这个是配置最大上传文件。value是字节为单位，下面这个也就是10M  --&gt;
        &lt;property name=&quot;maxUploadSize&quot; value=&quot;10485760&quot; /&gt;
    &lt;/bean&gt;

&lt;!--     开启SpringMVC框架注解的支持 标签是固定的--&gt;
    &lt;mvc:annotation-driven  /&gt;

&lt;/beans&gt;
</code></pre><hr>
<p>index.jsp</p>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/5
  Time: 11:25
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;文件上传&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h3&gt;文件上传&lt;/h3&gt;
&lt;form action=&quot;user/fileupload1&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
    选择上传文件：&lt;input type=&quot;file&quot; name=&quot;upload&quot;/&gt;
    &lt;br/&gt;
    &lt;input type=&quot;submit&quot; value=&quot;上传&quot;/&gt;
&lt;/form&gt;

&lt;form action=&quot;user/fileupload2&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
    选择上传文件：&lt;input type=&quot;file&quot; name=&quot;upload&quot;/&gt;
    &lt;br/&gt;
    &lt;input type=&quot;submit&quot; value=&quot;上传&quot;/&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<p>web.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;!--
  - This is the Cocoon web-app configurations file
  -
  - $Id$
  --&gt;
&lt;web-app version=&quot;2.4&quot;
         xmlns=&quot;http://java.sun.com/xml/ns/j2ee&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot;&gt;


  &lt;!--配置前端控制器--&gt;
  &lt;servlet&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
      &lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
  &lt;/servlet&gt;

  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;

  &lt;!--配置解决中文乱码的过滤器--&gt;
  &lt;filter&gt;
    &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;encoding&lt;/param-name&gt;
      &lt;param-value&gt;UTF-8&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/filter&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
&lt;/web-app&gt;
</code></pre><hr>
<p><img src="https://i.imgur.com/I7bTQPD.png" alt=""></p>
<h2 id="SpringMVC跨服务器方式的文件上传"><a href="#SpringMVC跨服务器方式的文件上传" class="headerlink" title="SpringMVC跨服务器方式的文件上传"></a>SpringMVC跨服务器方式的文件上传</h2><p><img src="https://i.imgur.com/coohqTT.png" alt=""><br>目前跨服务器的内容由于图片服务器没有打开所以目前还没成功，可能是因为图片服务器的配置问题。代码肯定没问题：</p>
<pre><code>package cn.itcast.controller;

import com.sun.jersey.api.client.Client;
import com.sun.jersey.api.client.WebResource;
import org.apache.commons.fileupload.FileItem;
import org.apache.commons.fileupload.disk.DiskFileItemFactory;
import org.apache.commons.fileupload.servlet.ServletFileUpload;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.multipart.MultipartFile;

import javax.servlet.http.HttpServletRequest;
import java.io.File;
import java.util.List;
import java.util.UUID;

/**
 * @Description TODO
 * @Author TT Hun
 * @Data 2019/11/5 11:26
 */
@Controller
@RequestMapping(&quot;/user&quot;)
public class UserController {
    /**
     * 跨服务器文件上传
     * @return
     */
    @RequestMapping(&quot;/fileupload3&quot;)
    public String fileuoload3(MultipartFile upload) throws Exception {
        System.out.println(&quot;跨服务器文件上传...&quot;);

        // 定义上传文件服务器路径
        String path = &quot;http://localhost:9999/uploads/&quot;;
        // 说明上传文件项
        // 获取上传文件的名称
        String filename = upload.getOriginalFilename();
        // 把文件的名称设置唯一值，uuid
        String uuid = UUID.randomUUID().toString().replace(&quot;-&quot;, &quot;&quot;);
        filename = uuid+&quot;_&quot;+filename;
        // 创建客户端的对象
        Client client = Client.create();
        // 和图片服务器进行连接
        WebResource webResource = client.resource(path + filename);
        // 上传文件
        webResource.put(upload.getBytes());
        return &quot;success&quot;;
    }
}
</code></pre><hr>
<p>springmvc.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;!-- 开启注解扫描 --&gt;
    &lt;context:component-scan base-package=&quot;cn.itcast&quot;/&gt;

    &lt;!-- 视图解析器对象 --&gt;
    &lt;bean id=&quot;internalResourceViewResolver&quot; class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/pages/&quot;/&gt;
        &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;
    &lt;/bean&gt;

    &lt;!--前端控制器，哪些静态资源不拦截--&gt;
    &lt;mvc:resources location=&quot;/css/&quot; mapping=&quot;/css/**&quot;/&gt;
    &lt;mvc:resources location=&quot;/images/&quot; mapping=&quot;/images/**&quot;/&gt;
    &lt;mvc:resources location=&quot;/js/&quot; mapping=&quot;/js/**&quot;/&gt;

    &lt;!--配置文件解析器对象--&gt;
    &lt;bean id=&quot;multipartResolver&quot; class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;&gt;
        &lt;property name=&quot;maxUploadSize&quot; value=&quot;10485760&quot; /&gt;
    &lt;/bean&gt;

    &lt;!-- 开启SpringMVC框架注解的支持 --&gt;
    &lt;mvc:annotation-driven /&gt;

&lt;/beans&gt;
</code></pre><hr>
<p>web.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the &quot;License&quot;); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--&gt;

&lt;!--
  - This is the Cocoon web-app configurations file
  -
  - $Id$
  --&gt;
&lt;web-app version=&quot;2.4&quot;
         xmlns=&quot;http://java.sun.com/xml/ns/j2ee&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot;&gt;


  &lt;!--配置前端控制器--&gt;
  &lt;servlet&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
      &lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
  &lt;/servlet&gt;

  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;

  &lt;!--配置解决中文乱码的过滤器--&gt;
  &lt;filter&gt;
    &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;encoding&lt;/param-name&gt;
      &lt;param-value&gt;UTF-8&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/filter&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
&lt;/web-app&gt;
</code></pre><hr>
<p>index.jsp</p>
<pre><code>    &lt;%--
      Created by IntelliJ IDEA.
      User: Hun
      Date: 2019/11/5
      Time: 11:25
      To change this template use File | Settings | File Templates.
    --%&gt;
    &lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
    &lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;文件上传&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
    &lt;h3&gt;文件上传&lt;/h3&gt;
    &lt;form action=&quot;user/fileupload1&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
        选择上传文件：&lt;input type=&quot;file&quot; name=&quot;upload&quot;/&gt;
        &lt;br/&gt;
        &lt;input type=&quot;submit&quot; value=&quot;上传&quot;/&gt;
    &lt;/form&gt;

    &lt;form action=&quot;user/fileupload2&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
        选择上传文件：&lt;input type=&quot;file&quot; name=&quot;upload&quot;/&gt;
        &lt;br/&gt;
        &lt;input type=&quot;submit&quot; value=&quot;上传&quot;/&gt;
    &lt;/form&gt;

    &lt;h2&gt;跨服务器文件上传&lt;/h2&gt;
    &lt;form action=&quot;user/fileupload3&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
        选择上传文件：&lt;input type=&quot;file&quot; name=&quot;upload&quot;/&gt;
        &lt;br/&gt;
        &lt;input type=&quot;submit&quot; value=&quot;上传&quot;/&gt;
    &lt;/form&gt;


    &lt;/body&gt;
    &lt;/html&gt;
***
success.jsp

&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/5
  Time: 11:28
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h3&gt;上传文件成功&lt;/h3&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<p>图片服务器略。</p>
<h1 id="第三章SpringMVC异常处理"><a href="#第三章SpringMVC异常处理" class="headerlink" title="第三章SpringMVC异常处理"></a>第三章SpringMVC异常处理</h1><h2 id="SpringMVC异常处理之处理代码编写"><a href="#SpringMVC异常处理之处理代码编写" class="headerlink" title="SpringMVC异常处理之处理代码编写"></a>SpringMVC异常处理之处理代码编写</h2><p><img src="https://i.imgur.com/ZHUrpOK.png" alt=""></p>
<pre><code>package cn.itcast.controller;

import cn.itcast.exception.SysException;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

/**
 * @Description TODO
 * @Author TT Hun
 * @Data 2019/11/5 22:38
 */
@Controller
@RequestMapping(&quot;/user&quot;)
public class UserController {
    @RequestMapping(&quot;/testException&quot;)
    public String testException() throws SysException {
        System.out.println(&quot;testException 执行了&quot;);
        try {
//        模拟异常
            int a = 10 / 0;
        } catch (Exception e) {
//            控制台打印异常信息
            e.printStackTrace();
//           向上抛出异常信息
            throw new SysException(&quot;查询所有用户出错了。。。&quot;);

        }
        return &quot;success&quot;;
    }
}
</code></pre><hr>
<pre><code>package cn.itcast.exception;

/**
 * @Description 自定义的异常类
 * @Author TT Hun
 * @Data 2019/11/5 23:06
 */
public class SysException extends Exception {
//    用来存储提示信息的
    private String message;

    @Override
    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }

    public SysException(String message) {
        this.message = message;
    }
}
</code></pre><hr>
<pre><code>package cn.itcast.exception;

import org.springframework.web.servlet.HandlerExceptionResolver;
import org.springframework.web.servlet.ModelAndView;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * @Description 异常处理器
 * @Author TT Hun
 * @Data 2019/11/5 23:10
 */
public class SysExceptionResolver implements HandlerExceptionResolver {
    /**
     * 处理异常逻辑
     * @param request
     * @param response
     * @param handler
     * @param ex
     * @return
     */
    public ModelAndView resolveException(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) {

        // 获取到异常对象
        SysException e = null;
//        判断是否是ex异常
        if(ex instanceof SysException) {
            e = (SysException) ex;
        } else{//如果不是的话
            e = new SysException(&quot;系统正在维护....&quot;);
        }
        // 创建ModelAndView对象，这个modelandview可以帮助跳转到那个界面
        ModelAndView mv = new ModelAndView();
//        向里面存入提示信息，存了一组键值对
        mv.addObject(&quot;errorMsg&quot;,e.getMessage());
//        往哪里跳转
        mv.setViewName(&quot;error&quot;);
        return mv;
    }
}
</code></pre><hr>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;!-- 开启注解扫描 --&gt;
    &lt;context:component-scan base-package=&quot;cn.itcast&quot;/&gt;

    &lt;!-- 视图解析器对象 --&gt;
    &lt;bean id=&quot;internalResourceViewResolver&quot; class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/pages/&quot;/&gt;
        &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;
    &lt;/bean&gt;

    &lt;!--前端控制器，哪些静态资源不拦截--&gt;
    &lt;mvc:resources location=&quot;/css/&quot; mapping=&quot;/css/**&quot;/&gt;
    &lt;mvc:resources location=&quot;/images/&quot; mapping=&quot;/images/**&quot;/&gt;
    &lt;mvc:resources location=&quot;/js/&quot; mapping=&quot;/js/**&quot;/&gt;

    &lt;!--配置异常处理器--&gt;
    &lt;bean id=&quot;sysExceptionResolver&quot; class=&quot;cn.itcast.exception.SysExceptionResolver&quot;/&gt;

    &lt;!-- 开启SpringMVC框架注解的支持 --&gt;
    &lt;mvc:annotation-driven /&gt;

&lt;/beans&gt;
</code></pre><hr>
<p>error.jsp</p>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/6
  Time: 9:35
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; isELIgnored=&quot;false&quot;%&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

    ${errorMsg}
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<p>success.jsp</p>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/5
  Time: 22:41
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h3&gt;测试成功&lt;/h3&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<pre><code>&lt;!DOCTYPE web-app PUBLIC
 &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;
 &quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot; &gt;

&lt;web-app&gt;
  &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;

  &lt;servlet&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
      &lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;

  &lt;!--配置解决中文乱码的过滤器--&gt;
  &lt;filter&gt;
    &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;encoding&lt;/param-name&gt;
      &lt;param-value&gt;UTF-8&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/filter&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;

&lt;/web-app&gt;
</code></pre><hr>
<p>index.jsp</p>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Administrator
  Date: 2018/5/5
  Time: 22:08
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

    &lt;h3&gt;异常处理&lt;/h3&gt;

    &lt;a href=&quot;user/testException&quot; &gt;异常处理&lt;/a&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<p>pom文件：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!--
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  &quot;License&quot;); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License.
--&gt;
&lt;!-- $Id: pom.xml 642118 2008-03-28 08:04:16Z reinhard $ --&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;
    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
        &lt;spring.version&gt;5.0.2.RELEASE&lt;/spring.version&gt;
    &lt;/properties&gt;


    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;

    &lt;name&gt;springmvc_day02_03_exception1&lt;/name&gt;
    &lt;artifactId&gt;springmvc_day02_03_exception1&lt;/artifactId&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.mortbay.jetty&lt;/groupId&gt;
                &lt;artifactId&gt;maven-jetty-plugin&lt;/artifactId&gt;
                &lt;version&gt;6.1.7&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;connectors&gt;
                        &lt;connector implementation=&quot;org.mortbay.jetty.nio.SelectChannelConnector&quot;&gt;
                            &lt;port&gt;8888&lt;/port&gt;
                            &lt;maxIdleTime&gt;30000&lt;/maxIdleTime&gt;
                        &lt;/connector&gt;
                    &lt;/connectors&gt;
                    &lt;webAppSourceDirectory&gt;${project.build.directory}/${pom.artifactId}-${pom.version}
                    &lt;/webAppSourceDirectory&gt;
                    &lt;contextPath&gt;/&lt;/contextPath&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
            &lt;version&gt;${spring.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-web&lt;/artifactId&gt;
            &lt;version&gt;${spring.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
            &lt;version&gt;${spring.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
            &lt;version&gt;2.5&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet.jsp&lt;/groupId&gt;
            &lt;artifactId&gt;jsp-api&lt;/artifactId&gt;
            &lt;version&gt;2.0&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

&lt;/project&gt;
</code></pre><hr>
<h2 id="SpringMVC中的拦截器"><a href="#SpringMVC中的拦截器" class="headerlink" title="SpringMVC中的拦截器"></a>SpringMVC中的拦截器</h2><p><img src="https://i.imgur.com/AJ9Uzzi.png" alt=""><br>拦截器只会拦截控制器中的方法，也就是Controller中的方法。JSP之类的资源不会拦截的。过滤器什么都可以拦截。也就是拦截器可以做的事情过滤器都可以做。但是过滤器可以做的事情拦截器不一定会做。<br><strong>拦截器完整代码</strong><br>注意Pom中的依赖使用那一些依赖：</p>
<p>先看一下目录；<br><img src="https://i.imgur.com/q7Ee3uo.png" alt=""></p>
<pre><code>package cn.itcast.controller.cn.itcast.interceptor;

import org.springframework.web.servlet.HandlerInterceptor;
import org.springframework.web.servlet.ModelAndView;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * 自定义拦截器
 */
public class MyInterceptor1 implements HandlerInterceptor{

    /**
     * 预处理，controller方法执行前
     * return true 放行，执行下一个拦截器，如果没有，执行controller中的方法
     * return false不放行
     * @param request
     * @param response
     * @param handler
     * @return
     * @throws Exception
     */
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        System.out.println(&quot;MyInterceptor1执行了...前1111&quot;);
        // request.getRequestDispatcher(&quot;/WEB-INF/pages/error.jsp&quot;).forward(request,response);
        return true;
    }

    /**
     * 后处理方法，controller方法执行后，success.jsp执行之前
     * @param request
     * @param response
     * @param handler
     * @param modelAndView
     * @throws Exception
     */
    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        System.out.println(&quot;MyInterceptor1执行了...后1111&quot;);
        // request.getRequestDispatcher(&quot;/WEB-INF/pages/error.jsp&quot;).forward(request,response);
    }

    /**
     * success.jsp页面执行后，该方法会执行
     * @param request
     * @param response
     * @param handler
     * @param ex
     * @throws Exception
     */
    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
        System.out.println(&quot;MyInterceptor1执行了...最后1111&quot;);
    }
}
</code></pre><hr>
<pre><code>package cn.itcast.controller.cn.itcast.interceptor;

import org.springframework.web.servlet.HandlerInterceptor;
import org.springframework.web.servlet.ModelAndView;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * 自定义拦截器
 */
public class MyInterceptor2 implements HandlerInterceptor{

    /**
     * 预处理，controller方法执行前
     * return true 放行，执行下一个拦截器，如果没有，执行controller中的方法
     * return false不放行
     * @param request
     * @param response
     * @param handler
     * @return
     * @throws Exception
     */
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        System.out.println(&quot;MyInterceptor1执行了...前2222&quot;);
        // request.getRequestDispatcher(&quot;/WEB-INF/pages/error.jsp&quot;).forward(request,response);
        return true;
    }

    /**
     * 后处理方法，controller方法执行后，success.jsp执行之前
     * @param request
     * @param response
     * @param handler
     * @param modelAndView
     * @throws Exception
     */
    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        System.out.println(&quot;MyInterceptor1执行了...后2222&quot;);
        // request.getRequestDispatcher(&quot;/WEB-INF/pages/error.jsp&quot;).forward(request,response);
    }

    /**
     * success.jsp页面执行后，该方法会执行
     * @param request
     * @param response
     * @param handler
     * @param ex
     * @throws Exception
     */
    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
        System.out.println(&quot;MyInterceptor1执行了...最后2222&quot;);
    }

}
</code></pre><hr>
<pre><code>package cn.itcast.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
@RequestMapping(&quot;/user&quot;)
public class UserController {

    @RequestMapping(&quot;/testInterceptor&quot;)
    public String testInterceptor(){
        System.out.println(&quot;testInterceptor执行了...&quot;);
        return &quot;success&quot;;
    }

}
</code></pre><hr>
<p>springmvc.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;!-- 开启注解扫描 --&gt;
    &lt;context:component-scan base-package=&quot;cn.itcast&quot;/&gt;

    &lt;!-- 视图解析器对象 --&gt;
    &lt;bean id=&quot;internalResourceViewResolver&quot; class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/pages/&quot;/&gt;
        &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;
    &lt;/bean&gt;

    &lt;!--前端控制器，哪些静态资源不拦截--&gt;
    &lt;mvc:resources location=&quot;/css/&quot; mapping=&quot;/css/**&quot;/&gt;
    &lt;mvc:resources location=&quot;/images/&quot; mapping=&quot;/images/**&quot;/&gt;
    &lt;mvc:resources location=&quot;/js/&quot; mapping=&quot;/js/**&quot;/&gt;

    &lt;!--配置拦截器--&gt;
    &lt;mvc:interceptors&gt;
        &lt;!--配置拦截器--&gt;
        &lt;mvc:interceptor&gt;
            &lt;!--要拦截的具体的方法--&gt;
            &lt;mvc:mapping path=&quot;/user/*&quot;/&gt;
            &lt;!--不要拦截的方法
            &lt;mvc:exclude-mapping path=&quot;&quot;/&gt;
            --&gt;
            &lt;!--配置拦截器对象--&gt;
            &lt;bean class=&quot;cn.itcast.controller.cn.itcast.interceptor.MyInterceptor1&quot; /&gt;
        &lt;/mvc:interceptor&gt;

        &lt;!--配置第二个拦截器--&gt;
        &lt;mvc:interceptor&gt;
            &lt;!--要拦截的具体的方法--&gt;
            &lt;mvc:mapping path=&quot;/**&quot;/&gt;
            &lt;!--不要拦截的方法
            &lt;mvc:exclude-mapping path=&quot;&quot;/&gt;
            --&gt;
            &lt;!--配置拦截器对象--&gt;
            &lt;bean class=&quot;cn.itcast.controller.cn.itcast.interceptor.MyInterceptor2&quot; /&gt;
        &lt;/mvc:interceptor&gt;
    &lt;/mvc:interceptors&gt;

    &lt;!-- 开启SpringMVC框架注解的支持 --&gt;
    &lt;mvc:annotation-driven /&gt;

&lt;/beans&gt;
</code></pre><hr>
<p>error.jsp</p>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/6
  Time: 9:35
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; isELIgnored=&quot;false&quot;%&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

    ${errorMsg}
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<p>success.jsp</p>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/5
  Time: 22:41
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h3&gt;测试成功&lt;/h3&gt;

&lt;%--这个代表执行的Java脚本--%&gt;
&lt;% System.out.println(&quot;success.jsp成功执行了...  &quot;); %&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<p>web.xml</p>
<pre><code>&lt;!DOCTYPE web-app PUBLIC
        &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;
        &quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot; &gt;

&lt;web-app&gt;
  &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;

  &lt;servlet&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
      &lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;

  &lt;!--配置解决中文乱码的过滤器--&gt;
  &lt;filter&gt;
    &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;encoding&lt;/param-name&gt;
      &lt;param-value&gt;UTF-8&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/filter&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;

&lt;/web-app&gt;
</code></pre><hr>
<p>index.jsp</p>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Administrator
  Date: 2018/5/5
  Time: 22:08
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

    &lt;h3&gt;拦截器&lt;/h3&gt;

    &lt;a href=&quot;user/testInterceptor&quot; &gt;拦截器&lt;/a&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<p>pom.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

  &lt;groupId&gt;cn.itcast&lt;/groupId&gt;
  &lt;artifactId&gt;springmvc_day02_04_interceptor&lt;/artifactId&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;packaging&gt;war&lt;/packaging&gt;

  &lt;name&gt;springmvc_day02_04_interceptor Maven Webapp&lt;/name&gt;
  &lt;!-- FIXME change it to the project&apos;s website --&gt;
  &lt;url&gt;http://www.example.com&lt;/url&gt;

  &lt;properties&gt;
    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
    &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
    &lt;spring.version&gt;5.0.2.RELEASE&lt;/spring.version&gt;
  &lt;/properties&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
      &lt;version&gt;${spring.version}&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-web&lt;/artifactId&gt;
      &lt;version&gt;${spring.version}&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework&lt;/groupId&gt;
      &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
      &lt;version&gt;${spring.version}&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
      &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
      &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
      &lt;version&gt;2.5&lt;/version&gt;
      &lt;scope&gt;provided&lt;/scope&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
      &lt;groupId&gt;javax.servlet.jsp&lt;/groupId&gt;
      &lt;artifactId&gt;jsp-api&lt;/artifactId&gt;
      &lt;version&gt;2.0&lt;/version&gt;
      &lt;scope&gt;provided&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

  &lt;build&gt;
    &lt;finalName&gt;springmvc_day02_04_interceptor&lt;/finalName&gt;
    &lt;pluginManagement&gt;&lt;!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) --&gt;
      &lt;plugins&gt;
        &lt;plugin&gt;
          &lt;artifactId&gt;maven-clean-plugin&lt;/artifactId&gt;
          &lt;version&gt;3.0.0&lt;/version&gt;
        &lt;/plugin&gt;
        &lt;plugin&gt;
          &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;
          &lt;version&gt;3.0.2&lt;/version&gt;
        &lt;/plugin&gt;
        &lt;plugin&gt;
          &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
          &lt;version&gt;3.7.0&lt;/version&gt;
        &lt;/plugin&gt;
        &lt;plugin&gt;
          &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
          &lt;version&gt;2.20.1&lt;/version&gt;
        &lt;/plugin&gt;
        &lt;plugin&gt;
          &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
          &lt;version&gt;3.2.0&lt;/version&gt;
        &lt;/plugin&gt;
        &lt;plugin&gt;
          &lt;artifactId&gt;maven-install-plugin&lt;/artifactId&gt;
          &lt;version&gt;2.5.2&lt;/version&gt;
        &lt;/plugin&gt;
        &lt;plugin&gt;
          &lt;artifactId&gt;maven-deploy-plugin&lt;/artifactId&gt;
          &lt;version&gt;2.8.2&lt;/version&gt;
        &lt;/plugin&gt;
      &lt;/plugins&gt;
    &lt;/pluginManagement&gt;
  &lt;/build&gt;
&lt;/project&gt;
</code></pre><hr>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://erichunn.github.io/2019/10/24/SpringMVC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Eric Hunn">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="无心是一首歌">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/24/SpringMVC/" itemprop="url">SpringMVC</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-24T20:57:21+08:00">
                2019-10-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://i.imgur.com/UvPSTxH.png" alt=""></p>
<p>构建SpringMVC工程：</p>
<p>首先解决工程添加木块过慢的问题，在添加工程的时候，添加如下的属性：</p>
<p><img src="https://i.imgur.com/LpwgIqJ.png" alt=""></p>
<p>然后因为开始工程目录不全，要添加一些目录：</p>
<p><img src="https://i.imgur.com/Kxm31KN.png" alt=""></p>
<p>需要把HelloController的类交给容器来处理，然后在这个方法上再添加一个注解@ResquestMapping。请求映射注解，也就是一发请求，这个方法就执行了，映射到前台的请求。需要添加一个请求的路径。path=/“hello”。然后服务器一旦启动，点击超链接，让点击超链接跳转到success.jsp界面即可。</p>
<p><img src="https://i.imgur.com/XsBaIY8.png" alt=""></p>
<p>下图是springmvc.xml文件配置文件头的讲解：<br><img src="https://i.imgur.com/J7ZJ0jx.png" alt=""></p>
<p>首先配置里面的开启注解扫描。然后加了这个之后，我们还要让SpringMVC加载这个Springmvc.xml这个配置文件。那么这是怎么加载的那？我们在WEB-INF文件里面的web.xml文件里面也就是前端控制器里面去加载。</p>
<p>前端控制器代码如下：</p>
<pre><code>&lt;!DOCTYPE web-app PUBLIC
 &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;
 &quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot; &gt;

&lt;web-app&gt;
  &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;

  &lt;!--配置前端控制器--&gt;
  &lt;servlet&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
      &lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
  &lt;/servlet&gt;

  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;

  &lt;!--配置解决中文乱码的过滤器--&gt;
  &lt;filter&gt;
    &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;encoding&lt;/param-name&gt;
      &lt;param-value&gt;UTF-8&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/filter&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;

&lt;/web-app&gt;
</code></pre><p>解释一下上面的代码通过org.springframework.web.servlet.DispatcherServlet这个类里面配置classpath:springmvc.xml属性就可以帮我们加载该配置文件</p>
<hr>
<p>下面是简单的入门案例的图解：<br><img src="https://i.imgur.com/wLI6qKd.jpg" alt=""></p>
<hr>
<p>前端发来请求/hello然后通过前端控制器映射到处理器映射器，然后controller里面的任何方法都会通过处理器适配器，然后在执行相对应的方法。就到了第5步执行，返回的是一个ModelAndView也就是返回的是哪个success.jsp的适配器页面</p>
<p><img src="https://i.imgur.com/lrTXHqi.png" alt=""></p>
<p>但是发现为什么只是在springmvc.xml文件中配置了前端控制器呢，因为在配置了springmvc的注解开启之后就默认配置了另外的着一些适配器映射器之类的。<br><img src="https://i.imgur.com/YhOJMgE.png" alt=""></p>
<hr>
<p>@RequestMapping用来和前端的请求实现配合。映射过来的。建立映射关联的。可以放到方法上，也可以放到当前类上</p>
<p>RequestMapping的属性： value和Path属性都是一样的，如果只有一个属性，那么也可以不写这个path和value这个</p>
<p><img src="https://i.imgur.com/iVu94S8.png" alt=""></p>
<p>例如：</p>
<p><img src="https://i.imgur.com/fsbMFI1.png" alt=""></p>
<hr>
<hr>
<hr>
<p>Springmvc02的视频由于未保存。尚且不理他。等有时间在去更新。</p>
<hr>
<hr>
<hr>
<p>首先是讲一下RequestParam注解：<br>先来一段例子：</p>
<p>anno.jsp类：</p>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/3
  Time: 16:55
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;

&lt;a href=&quot;anno/testRequestParam?username=haha&quot;&gt;RequestParam&lt;/a&gt;
&lt;body&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>paramController类：</p>
<pre><code>package cn.itcast.controller;

import cn.itcast.domain.Account;
import cn.itcast.domain.User;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

/**
 * @Description TODO
 * @Author TT Hun
 * @Data 2019/11/2 20:34
 */
@Controller
@RequestMapping(&quot;/param&quot;)
public class ParamController {

    @RequestMapping(&quot;/hello&quot;)
    public String testParam(String username, String password) {
        System.out.println(&quot;执行了。。。&quot;);
        System.out.println(&quot;用户名:&quot; + username);
        System.out.println(&quot;密码:&quot; + password);
        return &quot;success&quot;;
    }

    /**
     * 把返回的数据封装到一个javabean的类当中
     *
     * @return
     */
    @RequestMapping(&quot;/saveAccount&quot;)
    public String saveAccount(Account account) {
        System.out.println(&quot;执行了。。。&quot;);
        System.out.println(account);
        return &quot;success&quot;;
    }

    @RequestMapping(&quot;/saveUser&quot;)
    public String saveUser(User user){
        System.out.println(&quot;执行了。。。&quot;);
        System.out.println(user);
        return &quot;success&quot;;
    }
}
</code></pre><hr>
<p>一旦上面的username换成了name就不能识别了</p>
<p><img src="https://i.imgur.com/sScDjjc.png" alt=""><br>所以在Controller类的方法里加上这么一个参数，就可以将name对应的值传递给String username了<br><img src="https://i.imgur.com/3SAMmd9.png" alt=""></p>
<p>但是以后在jsp中就必须是name=”哈哈”。了，一旦更改成别的就不行了。</p>
<hr>
<h2 id="RequestBody注解"><a href="#RequestBody注解" class="headerlink" title="RequestBody注解"></a>RequestBody注解</h2><p><img src="https://i.imgur.com/i1JA9t9.png" alt=""><br>这个就不能写超链接，只能写表单通过post的方式提交</p>
<pre><code>package cn.itcast.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

/**
 * @Description 常用的注解
 * @Author TT Hun
 * @Data 2019/11/3 16:59
 */
@Controller
@RequestMapping(&quot;/anno&quot;)
public class AnnoController {

    @RequestMapping(&quot;/testRequestParam&quot;)
    public String  testRequestParam(String username){
        System.out.println(&quot;执行了。。。&quot;);
        System.out.println(username);
        return &quot;success&quot;;
    }

    @RequestMapping(&quot;/testRequestBody&quot;)
    public String  testRequestBody(@RequestBody String body){
        System.out.println(&quot;执行了。。。&quot;);
        System.out.println(body);
        return &quot;success&quot;;
    }


}
</code></pre><hr>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/2
  Time: 20:26
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;%--自定义类型转换器--%&gt;
    &lt;form action=&quot;param/testRequestBody&quot; method=&quot;post&quot;&gt;
        用户姓名：&lt;input type=&quot;text&quot; name=&quot;username&quot; /&gt;&lt;br/&gt;
        用户年龄：&lt;input type=&quot;text&quot; name=&quot;age&quot; /&gt;&lt;br/&gt;
        用户生日：&lt;input type=&quot;text&quot; name=&quot;date&quot; /&gt;&lt;br/&gt;
        &lt;input type=&quot;submit&quot; value=&quot;提交&quot; /&gt;
    &lt;/form&gt;

&lt;/form&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<h2 id="PathVariable注解"><a href="#PathVariable注解" class="headerlink" title="PathVariable注解"></a>PathVariable注解</h2><p><img src="https://i.imgur.com/Wkn5y2a.png" alt=""></p>
<p>Restful风格编程：<br>原来在Controller里写很多方法，在path里面写具体的路径，也就是一个方法有一个请求路径，如果是restful风格可以三个方法请求路径都是同一个。可以给不同的方法给固定的请求方式，也就是说可以根据不同的请求方式来执行。那么问题来了，查询一般都是get请求。同一个方法findall和findbyId都有可能 执行怎么办呢，可以通过占位符path=”user/{id}”通过一个id的占位符来区别。</p>
<p><img src="https://i.imgur.com/oendiQU.png" alt=""></p>
<p>PathVariable也就是取到的占位符的值。</p>
<p>代码如下：</p>
<pre><code>package cn.itcast.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

/**
 * @Description 常用的注解
 * @Author TT Hun
 * @Data 2019/11/3 16:59
 */
@Controller
@RequestMapping(&quot;/anno&quot;)
public class AnnoController {

    /**
     * PathVariable注解示例
     * @return
     */
    @RequestMapping(&quot;/testPathVariable/{sid}&quot;)
    public String  testPathVariable(@PathVariable(name=&quot;sid&quot;)String id ){
        System.out.println(&quot;执行了。。。&quot;);
        System.out.println(id);
        return &quot;success&quot;;
    }
}
</code></pre><hr>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/3
  Time: 16:55
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;

&lt;a href=&quot;/anno/testPathVariable/10&quot;&gt;testPathVariable&lt;/a&gt;

&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<h2 id="基于HiddenHttpMethodFliter的过滤器"><a href="#基于HiddenHttpMethodFliter的过滤器" class="headerlink" title="基于HiddenHttpMethodFliter的过滤器"></a>基于HiddenHttpMethodFliter的过滤器</h2><p><img src="https://i.imgur.com/oE9J2tq.png" alt=""></p>
<p>了解一下即可，因为webservie有API可以配置请求方式，并且浏览器中可以装插件来配置请求方式</p>
<hr>
<h2 id="RequestHeader注解"><a href="#RequestHeader注解" class="headerlink" title="RequestHeader注解"></a>RequestHeader注解</h2><p><img src="https://i.imgur.com/GMkzdbE.png" alt=""><br>一般用处不大</p>
<p>package cn.itcast.controller;</p>
<p>import org.springframework.stereotype.Controller;<br>import org.springframework.web.bind.annotation.*;</p>
<p>/**</p>
<ul>
<li>@Description 常用的注解</li>
<li>@Author TT Hun</li>
<li><p>@Data 2019/11/3 16:59<br>*/<br>@Controller<br>@RequestMapping(“/anno”)<br>public class AnnoController {</p>
<p> /**</p>
<ul>
<li>获取请求头信息的值</li>
<li>@param header</li>
<li>@return<br>*/<br>@RequestMapping(“/testRequestHeader”)<br>public String  testRequestHeader(@RequestHeader(value=”Accept”) String header){<br> System.out.println(“执行了。。。”);<br> System.out.println(header);<br> return “success”;<br>}<br>}</li>
</ul>
</li>
</ul>
<hr>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/3
  Time: 16:55
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;

&lt;a href=&quot;/anno/testRequestHeader&quot;&gt;testRequestHeader&lt;/a&gt;


&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<h2 id="Cookie-Value注解"><a href="#Cookie-Value注解" class="headerlink" title="Cookie Value注解"></a>Cookie Value注解</h2><p><img src="https://i.imgur.com/l98bt3M.png" alt=""></p>
<p>package cn.itcast.controller;</p>
<p>import org.springframework.stereotype.Controller;<br>import org.springframework.web.bind.annotation.*;</p>
<p>/**</p>
<ul>
<li>@Description 常用的注解</li>
<li>@Author TT Hun</li>
<li><p>@Data 2019/11/3 16:59<br>*/<br>@Controller<br>@RequestMapping(“/anno”)<br>public class AnnoController {</p>
<p> /**</p>
<ul>
<li>测试CookieValue注解</li>
<li>@param cookieValue</li>
<li>@return<br>*/<br>@RequestMapping(“/testCookieValue”)<br>public String  testCookieValue(@CookieValue(value=”JSESSIONID”) String cookieValue){<br> System.out.println(“执行了。。。”);<br> System.out.println(cookieValue);<br> return “success”;<br>}</li>
</ul>
</li>
</ul>
<p>}</p>
<hr>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/3
  Time: 16:55
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;

&lt;a href=&quot;/anno/testCookieValue&quot;&gt;testCookieValue&lt;/a&gt;

&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<h2 id="ModelAttribute注解"><a href="#ModelAttribute注解" class="headerlink" title="ModelAttribute注解"></a>ModelAttribute注解</h2><p><img src="https://i.imgur.com/j1zGJPI.png" alt=""></p>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/3
  Time: 16:55
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;

&lt;form action=&quot;anno/testModelAttribute&quot; method=&quot;post&quot;&gt;
    用户姓名：&lt;input type=&quot;text&quot; name=&quot;username&quot; /&gt;&lt;br/&gt;
    用户年龄：&lt;input type=&quot;text&quot; name=&quot;age&quot; /&gt;&lt;br/&gt;
    &lt;input type=&quot;submit&quot; value=&quot;提交&quot; /&gt;
&lt;/form&gt;
&lt;br&gt;

&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<pre><code>package cn.itcast.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.*;

/**
 * @Description 常用的注解
 * @Author TT Hun
 * @Data 2019/11/3 16:59
 */
@Controller
@RequestMapping(&quot;/anno&quot;)
public class AnnoController {

    /**
     * testModelAttribute测试
     * @return
     */
    @RequestMapping(&quot;/testModelAttribute&quot;)
    public String  testModelAttribute(){
        System.out.println(&quot;testModelAttribute执行了。。。&quot;);
        return &quot;success&quot;;
    }

    @ModelAttribute
    public void showUser(){
        System.out.println(&quot;showUser方法执行了...&quot;);
    }
}
</code></pre><hr>
<p>然后打印结果：<br><img src="https://i.imgur.com/UZn18Sr.png" alt=""></p>
<p>当提交的缺少一个数据，但是想让这个数据从数据库中查询或者缓存中查询。下面是有返回值的情况：</p>
<pre><code>package cn.itcast.controller;

import cn.itcast.domain.User;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.*;

import java.util.Date;

/**
 * @Description 常用的注解
 * @Author TT Hun
 * @Data 2019/11/3 16:59
 */
@Controller
@RequestMapping(&quot;/anno&quot;)
public class AnnoController {

    /**
     * testModelAttribute测试
     * @return
     */
    @RequestMapping(&quot;/testModelAttribute&quot;)
    public String  testModelAttribute(User user){
        System.out.println(&quot;testModelAttribute执行了。。。&quot;);
        System.out.println(user);
        return &quot;success&quot;;
    }


    /**
     * 测试ModelAttribute注解的有返回值的情况，
     */
    @ModelAttribute
    public User showUser(String uname ,Integer age){
        System.out.println(&quot;showUser方法执行了...&quot;);
//        通过用户名查询数据库（模拟）
        User user = new User();
        user.setUname(uname);
        user.setAge(age);
        user.setDate(new Date());
        return user;
    }
}
</code></pre><hr>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/3
  Time: 16:55
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;

&lt;form action=&quot;anno/testModelAttribute&quot; method=&quot;post&quot;&gt;
    用户姓名：&lt;input type=&quot;text&quot; name=&quot;uname&quot; /&gt;&lt;br/&gt;
    用户年龄：&lt;input type=&quot;text&quot; name=&quot;age&quot; /&gt;&lt;br/&gt;
    &lt;input type=&quot;submit&quot; value=&quot;提交&quot; /&gt;
&lt;/form&gt;
&lt;br&gt;


&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<p>打印结果：<br><img src="https://i.imgur.com/Mrcg4Ui.png" alt=""></p>
<hr>
<p>下面是没有返回值的写法，可以写入一个Map集合<br>    package cn.itcast.controller;</p>
<pre><code>import cn.itcast.domain.User;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.*;

import java.util.Date;
import java.util.Map;

/**
 * @Description 常用的注解
 * @Author TT Hun
 * @Data 2019/11/3 16:59
 */
@Controller
@RequestMapping(&quot;/anno&quot;)
public class AnnoController {
</code></pre><p>   /**</p>
<pre><code> * 测试CookieValue注解
 * @param cookieValue
 * @return
 */
@RequestMapping(&quot;/testCookieValue&quot;)
public String  testCookieValue(@CookieValue(value=&quot;JSESSIONID&quot;) String cookieValue){
    System.out.println(&quot;执行了。。。&quot;);
    System.out.println(cookieValue);
    return &quot;success&quot;;
}

    /**
     * 测试没有返回值的ModelAttribute注解
     */
    @ModelAttribute
    public void showUser(String uname , Integer age, Map&lt;String,User&gt; map){
        System.out.println(&quot;showUser方法执行了...&quot;);
//      通过用户名查询数据库（模拟）
        User user = new User();
        user.setUname(uname);
        user.setAge(age);
        user.setDate(new Date());
//      查完数据之后存入一个Map集合当中
        map.put(&quot;abc&quot;,user);
    }
}
</code></pre><hr>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/3
  Time: 16:55
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;form action=&quot;anno/testModelAttribute&quot; method=&quot;post&quot;&gt;
    用户姓名：&lt;input type=&quot;text&quot; name=&quot;uname&quot; /&gt;&lt;br/&gt;
    用户年龄：&lt;input type=&quot;text&quot; name=&quot;age&quot; /&gt;&lt;br/&gt;
    &lt;input type=&quot;submit&quot; value=&quot;提交&quot; /&gt;
&lt;/form&gt;
&lt;br&gt;

&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<h2 id="SessionAttribute注解-这个是重点看"><a href="#SessionAttribute注解-这个是重点看" class="headerlink" title="SessionAttribute注解 这个是重点看"></a>SessionAttribute注解 这个是重点看</h2><p><img src="https://i.imgur.com/xt5GfpQ.png" alt=""></p>
<p>用于在request域里面添加内容，存储到域当中去，并且可以在以后jsp的界面中显示出来。</p>
<pre><code>package cn.itcast.controller;

import cn.itcast.domain.User;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import javax.servlet.http.HttpServletRequest;
import java.util.Date;
import java.util.Map;

/**
 * @Description 常用的注解
 * @Author TT Hun
 * @Data 2019/11/3 16:59
 */
@Controller
@RequestMapping(&quot;/anno&quot;)
public class AnnoController {

    /**
     * SessionAttributes的注解
     * @return
     */
    @RequestMapping(&quot;/testSessionAttributes&quot;)
    public String testSessionAttributes(Model model){
        System.out.println(&quot;testSessionAttributes方法执行了...&quot;);
//       向requestSession域里面存值，然后在success.jsp里面取出来,底层会存储到request域对象当中去
        model.addAttribute(&quot;msg&quot;,&quot;美美&quot;);
        return &quot;success&quot;;
    }
}
</code></pre><hr>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/3
  Time: 16:55
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;

&lt;a href=&quot;/anno/testSessionAttributes&quot;&gt;testSessionAttributes&lt;/a&gt;
&lt;br&gt;

&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/10/24
  Time: 22:35
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; isELIgnored=&quot;false&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
        &lt;h3&gt;入门成功了&lt;/h3&gt;
&lt;%--        表示request域的集合--%&gt;
    ${ requestScope }
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<p>SessionAttributes这个注解智能作用在类上，相当于存到Session这个域当中去，<br>然后使用model.addAttribute相当于把这个信息存储到requestSession这个域当中去。<br>在这个里面添加这个这个</p>
<p><img src="https://i.imgur.com/31aZ2iR.png" alt=""><br>然后<br><img src="https://i.imgur.com/ft78run.png" alt=""><br>就会显示：<br><img src="https://i.imgur.com/Jr4T50X.png" alt=""></p>
<hr>
<p>操作Session的内容进行增加删除查看</p>
<pre><code>package cn.itcast.controller;

import cn.itcast.domain.User;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.bind.support.SessionStatus;

import javax.servlet.http.HttpServletRequest;
import java.util.Date;
import java.util.Map;

/**
 * @Description 常用的注解
 * @Author TT Hun
 * @Data 2019/11/3 16:59
 */
@Controller
@RequestMapping(&quot;/anno&quot;)
@SessionAttributes(value={&quot;msg&quot;})//把msg=“美美&quot;在存入到Session域里面一份
public class AnnoController {
    /**
     * 从Session域里面添加值
     * @return
     */
    @RequestMapping(&quot;/testSessionAttributes&quot;)
    public String testSessionAttributes(Model model){
        System.out.println(&quot;testSessionAttributes方法执行了...&quot;);
//       向requestSession域里面存值，然后在success.jsp里面取出来,底层会存储到request域对象当中去
        model.addAttribute(&quot;msg&quot;,&quot;美美&quot;);
        return &quot;success&quot;;
    }

    /**
     * 从Session域里面取值
     * @return
     */
    @RequestMapping(&quot;/getSessionAttributes&quot;)
    public String getSessionAttributes(ModelMap modelMap){
        System.out.println(&quot;testSessionAttributes方法执行了...&quot;);
//        从Session域里面取值。
        String msg = (String)modelMap.get(&quot;msg&quot;);
        System.out.println(msg);
        return &quot;success&quot;;
    }

    /**
     * 从Session域里面删除值
     * @return
     */
    @RequestMapping(&quot;/deleteSessionAttributes&quot;)
    public String deleteSessionAttributes(SessionStatus status){
        System.out.println(&quot;testSessionAttributes方法执行了...&quot;);
//       把Session里面的东西清除掉。
        status.setComplete();
        return &quot;success&quot;;
    }
}
</code></pre><hr>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/11/3
  Time: 16:55
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;

&lt;a href=&quot;/anno/testSessionAttributes&quot;&gt;testSessionAttributes&lt;/a&gt;
&lt;br&gt;
&lt;a href=&quot;/anno/getSessionAttributes&quot;&gt;getSessionAttributes&lt;/a&gt;
&lt;br&gt;
&lt;a href=&quot;/anno/deleteSessionAttributes&quot;&gt;deleteSessionAttributes&lt;/a&gt;
&lt;br&gt;

&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<pre><code>&lt;%--
  Created by IntelliJ IDEA.
  User: Hun
  Date: 2019/10/24
  Time: 22:35
  To change this template use File | Settings | File Templates.
--%&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; isELIgnored=&quot;false&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
        &lt;h3&gt;入门成功了&lt;/h3&gt;
&lt;%--        表示request域的集合--%&gt;
    ${ requestScope.msg }
    ${sessionScope}
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://erichunn.github.io/2019/10/24/Spring第四天-基于纯注解事务控制-回顾部分注解例子/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Eric Hunn">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="无心是一首歌">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/24/Spring第四天-基于纯注解事务控制-回顾部分注解例子/" itemprop="url">Spring第四天_基于纯注解事务控制+回顾部分注解例子</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-24T20:34:48+08:00">
                2019-10-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>package com.itheima.dao;

import com.itheima.domain.Account;

/**
 * 账户的持久层接口
 */
public interface IAccountDao {

    /**
     * 根据Id查询账户
     * @param accountId
     * @return
     */
    Account findAccountById(Integer accountId);

    /**
     * 根据名称查询账户
     * @param accountName
     * @return
     */
    Account findAccountByName(String accountName);

    /**
     * 更新账户
     * @param account
     */
    void updateAccount(Account account);
}
</code></pre><hr>
<pre><code>package com.itheima.dao.impl;

import com.itheima.dao.IAccountDao;
import com.itheima.domain.Account;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.BeanPropertyRowMapper;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;

import java.util.List;

/**
 * 账户的持久层实现类
 */
@Repository(&quot;accountDao&quot;)
public class AccountDaoImpl implements IAccountDao {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    @Override
    public Account findAccountById(Integer accountId) {
        List&lt;Account&gt; accounts = jdbcTemplate.query(&quot;select * from account where id = ?&quot;,new BeanPropertyRowMapper&lt;Account&gt;(Account.class),accountId);
        return accounts.isEmpty()?null:accounts.get(0);
    }

    @Override
    public Account findAccountByName(String accountName) {
        List&lt;Account&gt; accounts = jdbcTemplate.query(&quot;select * from account where name = ?&quot;,new BeanPropertyRowMapper&lt;Account&gt;(Account.class),accountName);
        if(accounts.isEmpty()){
            return null;
        }
        if(accounts.size()&gt;1){
            throw new RuntimeException(&quot;结果集不唯一&quot;);
        }
        return accounts.get(0);
    }

    @Override
    public void updateAccount(Account account) {
        jdbcTemplate.update(&quot;update account set name=?,money=? where id=?&quot;,account.getName(),account.getMoney(),account.getId());
    }
}
</code></pre><hr>
<pre><code>package com.itheima.domain;

import java.io.Serializable;

/**
 * 账户的实体类
 */
public class Account implements Serializable {

    private Integer id;
    private String name;
    private Float money;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Float getMoney() {
        return money;
    }

    public void setMoney(Float money) {
        this.money = money;
    }

    @Override
    public String toString() {
        return &quot;Account{&quot; +
                &quot;id=&quot; + id +
                &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +
                &quot;, money=&quot; + money +
                &apos;}&apos;;
    }
}
</code></pre><hr>
<pre><code>package com.itheima.service;

import com.itheima.domain.Account;

/**
 * 账户的业务层接口
 */
public interface IAccountService {
    /**
     * 根据id查询账户信息
     * @param accountId
     * @return
     */
    Account findAccountById(Integer accountId);

    /**
     * 转账
     * @param sourceName    转成账户名称
     * @param targetName    转入账户名称
     * @param money         转账金额
     */
    void transfer(String sourceName, String targetName, Float money);
}
</code></pre><hr>
<pre><code>package com.itheima.service.impl;

import com.itheima.dao.IAccountDao;
import com.itheima.domain.Account;
import com.itheima.service.IAccountService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Propagation;
import org.springframework.transaction.annotation.Transactional;

/**
 * 账户的业务层实现类
 *
 * 事务控制应该都是在业务层
 */
@Service(&quot;accountService&quot;)
@Transactional(propagation= Propagation.SUPPORTS,readOnly=true)//只读型事务的配置
public class AccountServiceImpl implements IAccountService{

    @Autowired
    private IAccountDao accountDao;


    @Override
    public Account findAccountById(Integer accountId) {
        return accountDao.findAccountById(accountId);

    }


    //需要的是读写型事务配置
    @Transactional(propagation= Propagation.REQUIRED,readOnly=false)
    @Override
    public void transfer(String sourceName, String targetName, Float money) {
        System.out.println(&quot;transfer....&quot;);
            //2.1根据名称查询转出账户
            Account source = accountDao.findAccountByName(sourceName);
            //2.2根据名称查询转入账户
            Account target = accountDao.findAccountByName(targetName);
            //2.3转出账户减钱
            source.setMoney(source.getMoney()-money);
            //2.4转入账户加钱
            target.setMoney(target.getMoney()+money);
            //2.5更新转出账户
            accountDao.updateAccount(source);

//            int i=1/0;

            //2.6更新转入账户
            accountDao.updateAccount(target);
    }
}
</code></pre><hr>
<p>重点看下面Config文件夹下面几个类：</p>
<pre><code>package config;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.datasource.DriverManagerDataSource;

import javax.sql.DataSource;

/**
 * 和连接数据库相关的配置类
 */
public class JdbcConfig {

    @Value(&quot;${jdbc.driver}&quot;)
    private String driver;

    @Value(&quot;${jdbc.url}&quot;)
    private String url;

    @Value(&quot;${jdbc.username}&quot;)
    private String username;

    @Value(&quot;${jdbc.password}&quot;)
    private String password;

    /**
     * 创建JdbcTemplate
     * @param dataSource
     * @return
     */
    @Bean(name=&quot;jdbcTemplate&quot;)
    public JdbcTemplate createJdbcTemplate(DataSource dataSource){
        return new JdbcTemplate(dataSource);
    }

    /**
     * 创建数据源对象
     * @return
     */
    @Bean(name=&quot;dataSource&quot;)
    public DataSource createDataSource(){
        DriverManagerDataSource ds = new DriverManagerDataSource();
        ds.setDriverClassName(driver);
        ds.setUrl(url);
        ds.setUsername(username);
        ds.setPassword(password);
        return ds;
    }
}
</code></pre><hr>
<pre><code>package config;

import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Import;
import org.springframework.context.annotation.PropertySource;
import org.springframework.transaction.annotation.EnableTransactionManagement;

/**
 * spring的配置类，相当于bean.xml
 */
@Configuration
@ComponentScan(&quot;com.itheima&quot;)
@Import({JdbcConfig.class,TransactionConfig.class})
@PropertySource(&quot;jdbcConfig.properties&quot;)
@EnableTransactionManagement
public class SpringConfiguration {
}
</code></pre><hr>
<pre><code>package config;

import org.springframework.context.annotation.Bean;
import org.springframework.jdbc.datasource.DataSourceTransactionManager;
import org.springframework.transaction.PlatformTransactionManager;

import javax.sql.DataSource;

/**
 * 和事务相关的配置类
 */
public class TransactionConfig {

    /**
     * 用于创建事务管理器对象
     * @param dataSource
     * @return
     */
    @Bean(name=&quot;transactionManager&quot;)
    public PlatformTransactionManager createTransactionManager(DataSource dataSource){
        return new DataSourceTransactionManager(dataSource);
    }
}
</code></pre><hr>
<p>resource包下properties文件：</p>
<pre><code>jdbc.driver=com.mysql.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/eesy
jdbc.username=root
jdbc.password=1234
</code></pre><hr>
<pre><code>package com.itheima.test;

import com.itheima.service.IAccountService;
import config.SpringConfiguration;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

/**
 * 使用Junit单元测试：测试我们的配置
 */
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(classes= SpringConfiguration.class)
public class AccountServiceTest {

    @Autowired
    private  IAccountService as;

    @Test
    public  void testTransfer(){
        as.transfer(&quot;aaa&quot;,&quot;bbb&quot;,100f);

    }

}
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://erichunn.github.io/2019/10/23/Spring第四天-关于事务的控制通过XML和纯注解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Eric Hunn">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="无心是一首歌">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/23/Spring第四天-关于事务的控制通过XML和纯注解/" itemprop="url">Spring第四天_关于事务的控制通过XML和纯注解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-23T16:01:28+08:00">
                2019-10-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h2 id="Spring控制的一组关于事务的"><a href="#Spring控制的一组关于事务的" class="headerlink" title="Spring控制的一组关于事务的"></a><strong>Spring控制的一组关于事务的</strong></h2><p><img src="https://i.imgur.com/wbPn7UK.png" alt=""></p>
<p><img src="https://i.imgur.com/tuVVVR8.png" alt=""></p>
<p><img src="https://i.imgur.com/r7PWC1h.png" alt=""></p>
<p><img src="https://i.imgur.com/2pWccm5.png" alt=""></p>
<p><img src="https://i.imgur.com/LatSmwW.png" alt=""></p>
<p><img src="https://i.imgur.com/QgRHylQ.png" alt=""><br><img src="https://i.imgur.com/LzhM2Vn.png" alt=""></p>
<h2 id="Spring基于XML的声明式事务控制（）"><a href="#Spring基于XML的声明式事务控制（）" class="headerlink" title="Spring基于XML的声明式事务控制（）"></a>Spring基于XML的声明式事务控制（）</h2><p>前面的处理还是按照以前银行例子的配置，这个地方重点看bean配置文件的配置。</p>
<pre><code>package com.itheima.dao;

import com.itheima.domain.Account;

/**
 * 账户的持久层接口
 */
public interface IAccountDao {

    /**
     * 根据Id查询账户
     * @param accountId
     * @return
     */
    Account findAccountById(Integer accountId);

    /**
     * 根据名称查询账户
     * @param accountName
     * @return
     */
    Account findAccountByName(String accountName);

    /**
     * 更新账户
     * @param account
     */
    void updateAccount(Account account);
}
</code></pre><hr>
<pre><code>package com.itheima.dao.impl;

import com.itheima.dao.IAccountDao;
import com.itheima.domain.Account;
import org.springframework.jdbc.core.BeanPropertyRowMapper;
import org.springframework.jdbc.core.support.JdbcDaoSupport;

import java.util.List;

/**
 * 账户的持久层实现类
 */
public class AccountDaoImpl extends JdbcDaoSupport implements IAccountDao {

    @Override
    public Account findAccountById(Integer accountId) {
        List&lt;Account&gt; accounts = super.getJdbcTemplate().query(&quot;select * from account where id = ?&quot;,new BeanPropertyRowMapper&lt;Account&gt;(Account.class),accountId);
        return accounts.isEmpty()?null:accounts.get(0);
    }

    @Override
    public Account findAccountByName(String accountName) {
        List&lt;Account&gt; accounts = super.getJdbcTemplate().query(&quot;select * from account where name = ?&quot;,new BeanPropertyRowMapper&lt;Account&gt;(Account.class),accountName);
        if(accounts.isEmpty()){
            return null;
        }
        if(accounts.size()&gt;1){
            throw new RuntimeException(&quot;结果集不唯一&quot;);
        }
        return accounts.get(0);
    }

    @Override
    public void updateAccount(Account account) {
        super.getJdbcTemplate().update(&quot;update account set name=?,money=? where id=?&quot;,account.getName(),account.getMoney(),account.getId());
    }
}
</code></pre><hr>
<pre><code>package com.itheima.domain;

import java.io.Serializable;

/**
 * 账户的实体类
 */
public class Account implements Serializable {

    private Integer id;
    private String name;
    private Float money;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Float getMoney() {
        return money;
    }

    public void setMoney(Float money) {
        this.money = money;
    }

    @Override
    public String toString() {
        return &quot;Account{&quot; +
                &quot;id=&quot; + id +
                &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +
                &quot;, money=&quot; + money +
                &apos;}&apos;;
    }
}
</code></pre><hr>
<pre><code>package com.itheima.service;

import com.itheima.domain.Account;

/**
 * 账户的业务层接口
 */
public interface IAccountService {
    /**
     * 根据id查询账户信息
     * @param accountId
     * @return
     */
    Account findAccountById(Integer accountId);

    /**
     * 转账
     * @param sourceName    转成账户名称
     * @param targetName    转入账户名称
     * @param money         转账金额
     */
    void transfer(String sourceName, String targetName, Float money);
}
</code></pre><hr>
<pre><code>package com.itheima.service.impl;

import com.itheima.dao.IAccountDao;
import com.itheima.domain.Account;
import com.itheima.service.IAccountService;

/**
 * 账户的业务层实现类
 *
 * 事务控制应该都是在业务层
 */
public class AccountServiceImpl implements IAccountService{

    private IAccountDao accountDao;

    public void setAccountDao(IAccountDao accountDao) {
        this.accountDao = accountDao;
    }

    @Override
    public Account findAccountById(Integer accountId) {
        return accountDao.findAccountById(accountId);

    }



    @Override
    public void transfer(String sourceName, String targetName, Float money) {
        System.out.println(&quot;transfer....&quot;);
            //2.1根据名称查询转出账户
            Account source = accountDao.findAccountByName(sourceName);
            //2.2根据名称查询转入账户
            Account target = accountDao.findAccountByName(targetName);
            //2.3转出账户减钱
            source.setMoney(source.getMoney()-money);
            //2.4转入账户加钱
            target.setMoney(target.getMoney()+money);
            //2.5更新转出账户
            accountDao.updateAccount(source);

            int i=1/0;

            //2.6更新转入账户
            accountDao.updateAccount(target);
    }
}
</code></pre><hr>
<h3 id="下面重点看："><a href="#下面重点看：" class="headerlink" title="下面重点看："></a>下面重点看：</h3><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;
       xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;
       xsi:schemaLocation=&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt;

    &lt;!-- 配置业务层--&gt;
    &lt;bean id=&quot;accountService&quot; class=&quot;com.itheima.service.impl.AccountServiceImpl&quot;&gt;
        &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!-- 配置账户的持久层--&gt;
    &lt;bean id=&quot;accountDao&quot; class=&quot;com.itheima.dao.impl.AccountDaoImpl&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;


    &lt;!-- 配置数据源--&gt;
    &lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/eesy&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;username&quot; value=&quot;root&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;1234&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!-- spring中基于XML的声明式事务控制配置步骤
        1、配置事务管理器
        2、配置事务的通知
                此时我们需要导入事务的约束 tx名称空间和约束，同时也需要aop的
                使用tx:advice标签配置事务通知
                    属性：
                        id：给事务通知起一个唯一标识
                        transaction-manager：给事务通知提供一个事务管理器引用
        3、配置AOP中的通用切入点表达式
        4、建立事务通知和切入点表达式的对应关系
        5、配置事务的属性
               是在事务的通知tx:advice标签的内部

     --&gt;
    &lt;!-- 配置事务管理器 --&gt;
    &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!-- 配置事务的通知--&gt;
    &lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;transactionManager&quot;&gt;
        &lt;!-- 配置事务的属性
                isolation：用于指定事务的隔离级别。默认值是DEFAULT，表示使用数据库的默认隔离级别。
                propagation：用于指定事务的传播行为。默认值是REQUIRED，表示一定会有事务，增删改的选择。查询方法可以选择SUPPORTS。
                read-only：用于指定事务是否只读。只有查询方法才能设置为true。默认值是false，表示读写。
                timeout：用于指定事务的超时时间，默认值是-1，表示永不超时。如果指定了数值，以秒为单位。
                rollback-for：用于指定一个异常，当产生该异常时，事务回滚，产生其他异常时，事务不回滚。没有默认值。表示任何异常都回滚。
                no-rollback-for：用于指定一个异常，当产生该异常时，事务不回滚，产生其他异常时事务回滚。没有默认值。表示任何异常都回滚。
        --&gt;
        &lt;tx:attributes&gt;
            &lt;tx:method name=&quot;*&quot; propagation=&quot;REQUIRED&quot; read-only=&quot;false&quot;/&gt;
            &lt;tx:method name=&quot;find*&quot; propagation=&quot;SUPPORTS&quot; read-only=&quot;true&quot;&gt;&lt;/tx:method&gt;
        &lt;/tx:attributes&gt;
    &lt;/tx:advice&gt;

    &lt;!-- 配置aop--&gt;
    &lt;aop:config&gt;
        &lt;!-- 配置切入点表达式--&gt;
        &lt;aop:pointcut id=&quot;pt1&quot; expression=&quot;execution(* com.itheima.service.impl.*.*(..))&quot;&gt;&lt;/aop:pointcut&gt;
        &lt;!--建立切入点表达式和事务通知的对应关系 --&gt;
        &lt;aop:advisor advice-ref=&quot;txAdvice&quot; pointcut-ref=&quot;pt1&quot;&gt;&lt;/aop:advisor&gt;
    &lt;/aop:config&gt;
&lt;/beans&gt;
</code></pre><hr>
<pre><code>package com.itheima.test;

import com.itheima.service.IAccountService;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

/**
 * 使用Junit单元测试：测试我们的配置
 */
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = &quot;classpath:bean.xml&quot;)
public class AccountServiceTest {

    @Autowired
    private  IAccountService as;

    @Test
    public  void testTransfer(){
        as.transfer(&quot;aaa&quot;,&quot;bbb&quot;,100f);

    }
}
</code></pre><hr>
<p>这个地方重点看的配置就是bean里面的配置：</p>
<hr>
<p>两种DAO的编写方式：（回顾一下DAO的实现方式）<br><img src="https://i.imgur.com/MZUtq3f.png" alt=""></p>
<p><img src="https://i.imgur.com/aFDLkTS.png" alt=""></p>
<hr>
<pre><code>package com.itheima.dao;

import com.itheima.domain.Account;

/**
 * 账户的持久层接口
 */
public interface IAccountDao {

    /**
     * 根据Id查询账户
     * @param accountId
     * @return
     */
    Account findAccountById(Integer accountId);

    /**
     * 根据名称查询账户
     * @param accountName
     * @return
     */
    Account findAccountByName(String accountName);

    /**
     * 更新账户
     * @param account
     */
    void updateAccount(Account account);
}
</code></pre><hr>
<pre><code>package com.itheima.dao.impl;

import com.itheima.dao.IAccountDao;
import com.itheima.domain.Account;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.BeanPropertyRowMapper;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;

import java.util.List;

/**
 * 账户的持久层实现类
 */
@Repository(&quot;accountDao&quot;)
public class AccountDaoImpl implements IAccountDao {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    @Override
    public Account findAccountById(Integer accountId) {
        List&lt;Account&gt; accounts = jdbcTemplate.query(&quot;select * from account where id = ?&quot;,new BeanPropertyRowMapper&lt;Account&gt;(Account.class),accountId);
        return accounts.isEmpty()?null:accounts.get(0);
    }

    @Override
    public Account findAccountByName(String accountName) {
        List&lt;Account&gt; accounts = jdbcTemplate.query(&quot;select * from account where name = ?&quot;,new BeanPropertyRowMapper&lt;Account&gt;(Account.class),accountName);
        if(accounts.isEmpty()){
            return null;
        }
        if(accounts.size()&gt;1){
            throw new RuntimeException(&quot;结果集不唯一&quot;);
        }
        return accounts.get(0);
    }

    @Override
    public void updateAccount(Account account) {
        jdbcTemplate.update(&quot;update account set name=?,money=? where id=?&quot;,account.getName(),account.getMoney(),account.getId());
    }
}
</code></pre><hr>
<pre><code>package com.itheima.domain;

import java.io.Serializable;

/**
 * 账户的实体类
 */
public class Account implements Serializable {

    private Integer id;
    private String name;
    private Float money;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Float getMoney() {
        return money;
    }

    public void setMoney(Float money) {
        this.money = money;
    }

    @Override
    public String toString() {
        return &quot;Account{&quot; +
                &quot;id=&quot; + id +
                &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +
                &quot;, money=&quot; + money +
                &apos;}&apos;;
    }
}
</code></pre><hr>
<pre><code>package com.itheima.service;

import com.itheima.domain.Account;

/**
 * 账户的业务层接口
 */
public interface IAccountService {
    /**
     * 根据id查询账户信息
     * @param accountId
     * @return
     */
    Account findAccountById(Integer accountId);

    /**
     * 转账
     * @param sourceName    转成账户名称
     * @param targetName    转入账户名称
     * @param money         转账金额
     */
    void transfer(String sourceName, String targetName, Float money);
}
</code></pre><hr>
<pre><code>package com.itheima.service.impl;

import com.itheima.dao.IAccountDao;
import com.itheima.domain.Account;
import com.itheima.service.IAccountService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Propagation;
import org.springframework.transaction.annotation.Transactional;

/**
 * 账户的业务层实现类
 *
 * 事务控制应该都是在业务层
 */
@Service(&quot;accountService&quot;)
@Transactional(propagation= Propagation.SUPPORTS,readOnly=true)//只读型事务的配置
public class AccountServiceImpl implements IAccountService{

    @Autowired
    private IAccountDao accountDao;


    @Override
    public Account findAccountById(Integer accountId) {
        return accountDao.findAccountById(accountId);

    }


    //需要的是读写型事务配置
    @Transactional(propagation= Propagation.REQUIRED,readOnly=false)
    @Override
    public void transfer(String sourceName, String targetName, Float money) {
        System.out.println(&quot;transfer....&quot;);
            //2.1根据名称查询转出账户
            Account source = accountDao.findAccountByName(sourceName);
            //2.2根据名称查询转入账户
            Account target = accountDao.findAccountByName(targetName);
            //2.3转出账户减钱
            source.setMoney(source.getMoney()-money);
            //2.4转入账户加钱
            target.setMoney(target.getMoney()+money);
            //2.5更新转出账户
            accountDao.updateAccount(source);

            int i=1/0;

            //2.6更新转入账户
            accountDao.updateAccount(target);
    }
}
</code></pre><hr>
<p>重点的bean配置文件：</p>
<hr>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;
       xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;!-- 配置spring创建容器时要扫描的包--&gt;
    &lt;context:component-scan base-package=&quot;com.itheima&quot;&gt;&lt;/context:component-scan&gt;

    &lt;!-- 配置JdbcTemplate--&gt;
    &lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;



    &lt;!-- 配置数据源--&gt;
    &lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/eesy&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;username&quot; value=&quot;root&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;1234&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!-- spring中基于注解 的声明式事务控制配置步骤
        1、配置事务管理器
        2、开启spring对注解事务的支持
        3、在需要事务支持的地方使用@Transactional注解
     --&gt;
    &lt;!-- 配置事务管理器 --&gt;
    &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!-- 开启spring对注解事务的支持--&gt;
    &lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;&gt;&lt;/tx:annotation-driven&gt;
&lt;/beans&gt;
</code></pre><hr>
<pre><code>package com.itheima.test;

import com.itheima.service.IAccountService;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

/**
 * 使用Junit单元测试：测试我们的配置
 */
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = &quot;classpath:bean.xml&quot;)
public class AccountServiceTest {

    @Autowired
    private  IAccountService as;

    @Test
    public  void testTransfer(){
        as.transfer(&quot;aaa&quot;,&quot;bbb&quot;,100f);

    }

}
</code></pre><hr>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://erichunn.github.io/2019/10/08/Spring第四天_Spring中事务控制-作业例子/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Eric Hunn">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="无心是一首歌">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/08/Spring第四天_Spring中事务控制-作业例子/" itemprop="url">Spring第四天_Spring中事务控制-作业例子</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-08T22:53:37+08:00">
                2019-10-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>这节主要讲解了从银行转账的一个基于XML配置文件的，一个是基于注解配置的两个案例。2个都是比较完整的代码，没有测试过，可能因为数据库8.0问题导致连接不上，但是代码应该没有问题。可以作为例子深入研究一下注解和XML文件配置。</strong></p>
</blockquote>
<p>首先，由注解开发的银行转账案例完整版作业：</p>
<pre><code>package com.itheima.dao;

import com.itheima.domain.Account;

import java.util.List;

/**
 * 账户的持久层接口
 */
public interface IAccountDao {

    /**
     * 查询所有
     * @return
     */
    List&lt;Account&gt; findAllAccount();

    /**
     * 查询一个
     * @return
     */
    Account findAccountById(Integer accountId);

    /**
     * 保存
     * @param account
     */
    void saveAccount(Account account);

    /**
     * 更新
     * @param account
     */
    void updateAccount(Account account);

    /**
     * 删除
     * @param acccountId
     */
    void deleteAccount(Integer acccountId);

    /**
     * 根据名称查账户
     * @param accountName   用户名称
     * @return      如果有唯一结果就返回，如果没有结果就返回Null,结果集超过一个返回异常
     */
    Account findAccountByName(String accountName);
}
</code></pre><hr>
<pre><code>package com.itheima.dao.impl;

import com.itheima.dao.IAccountDao;
import com.itheima.domain.Account;
import com.itheima.utils.ConnectionUtils;
import org.apache.commons.dbutils.QueryRunner;
import org.apache.commons.dbutils.handlers.BeanHandler;
import org.apache.commons.dbutils.handlers.BeanListHandler;

import java.util.List;

/**
 * 账户的持久层实现类
 */
public class AccountDaoImpl implements IAccountDao {

    private QueryRunner runner;
    private ConnectionUtils connectionUtils;

    public void setRunner(QueryRunner runner) {
        this.runner = runner;
    }

    public void setConnectionUtils(ConnectionUtils connectionUtils) {
        this.connectionUtils = connectionUtils;
    }

    public List&lt;Account&gt; findAllAccount() {
        try{
            return runner.query(connectionUtils.getThreadConnection(),&quot;select * from account&quot;,new BeanListHandler&lt;Account&gt;(Account.class));
        }catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public Account findAccountById(Integer accountId) {
        try{
            return runner.query(connectionUtils.getThreadConnection(),&quot;select * from account where id = ? &quot;,new BeanHandler&lt;Account&gt;(Account.class),accountId);
        }catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public void saveAccount(Account account) {
        try{
            runner.update(connectionUtils.getThreadConnection(),&quot;insert into account(name,money)values(?,?)&quot;,account.getName(),account.getMoney());
        }catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public void updateAccount(Account account) {
        try{
            runner.update(connectionUtils.getThreadConnection(),&quot;update account set name=?,money=? where id=?&quot;,account.getName(),account.getMoney(),account.getId());
        }catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public void deleteAccount(Integer accountId) {
        try{
            runner.update(connectionUtils.getThreadConnection(),&quot;delete from account where id=?&quot;,accountId);
        }catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public Account findAccountByName(String accountName) {
        try{
            List&lt;Account&gt; accounts = runner.query(connectionUtils.getThreadConnection(),&quot;select * from account where name = ? &quot;,new BeanListHandler&lt;Account&gt;(Account.class),accountName);
            if(accounts == null || accounts.size() == 0){
                return null;
            }
            if(accounts.size() &gt; 1){
                throw new RuntimeException(&quot;结果集不唯一，数据有问题&quot;);
            }
            return accounts.get(0);
        }catch (Exception e) {
            throw new RuntimeException(e);
        }
    }
}
</code></pre><hr>
<pre><code>package com.itheima.domain;

import java.io.Serializable;

/**
 * 账户的实体类
 */
public class Account implements Serializable {

    private Integer id;
    private String name;
    private Float money;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Float getMoney() {
        return money;
    }

    public void setMoney(Float money) {
        this.money = money;
    }

    @Override
    public String toString() {
        return &quot;Account{&quot; +
                &quot;id=&quot; + id +
                &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +
                &quot;, money=&quot; + money +
                &apos;}&apos;;
    }
}
</code></pre><hr>
<pre><code>package com.itheima.service;

import com.itheima.domain.Account;

import java.util.List;

/**
 * 账户的业务层接口
 */
public interface IAccountService {

    /**
     * 查询所有
     * @return
     */
    List&lt;Account&gt; findAllAccount();

    /**
     * 查询一个
     * @return
     */
    Account findAccountById(Integer accountId);

    /**
     * 保存
     * @param account
     */
    void saveAccount(Account account);

    /**
     * 更新
     * @param account
     */
    void updateAccount(Account account);

    /**
     * 删除
     * @param acccountId
     */
    void deleteAccount(Integer acccountId);

    /**
     *
     * 转账方法
     * @param sourceName    转出账户名称
     * @param targetName    转入账户名称
     * @param money         转账金额
     */
    void transfer(String sourceName, String targetName, Float money);
}
</code></pre><hr>
<pre><code>package com.itheima.service.impl;

import com.itheima.dao.IAccountDao;
import com.itheima.domain.Account;
import com.itheima.service.IAccountService;
import com.itheima.utils.TransactionManager;

import java.util.List;

/**
 * 账户的业务层实现类
 *
 * 事务控制应该都是在业务层
 */
public class AccountServiceImpl implements IAccountService{

    private IAccountDao accountDao;
    private TransactionManager txManager;

    public void setTxManager(TransactionManager txManager) {
        this.txManager = txManager;
    }

    public void setAccountDao(IAccountDao accountDao) {
        this.accountDao = accountDao;
    }

    @Override
    public List&lt;Account&gt; findAllAccount() {
        try {
            //1.开启事务
            txManager.beginTransaction();
            //2.执行操作
            List&lt;Account&gt; accounts = accountDao.findAllAccount();
            //3.提交事务
            txManager.commit();
            //4.返回结果
            return accounts;
        }catch (Exception e){
            //5.回滚操作
            txManager.rollback();
            throw new RuntimeException(e);
        }finally {
            //6.释放连接
            txManager.release();
        }

    }

    @Override
    public Account findAccountById(Integer accountId) {
        try {
            //1.开启事务
            txManager.beginTransaction();
            //2.执行操作
            Account account = accountDao.findAccountById(accountId);
            //3.提交事务
            txManager.commit();
            //4.返回结果
            return account;
        }catch (Exception e){
            //5.回滚操作
            txManager.rollback();
            throw new RuntimeException(e);
        }finally {
            //6.释放连接
            txManager.release();
        }
    }

    @Override
    public void saveAccount(Account account) {
        try {
            //1.开启事务
            txManager.beginTransaction();
            //2.执行操作
            accountDao.saveAccount(account);
            //3.提交事务
            txManager.commit();
        }catch (Exception e){
            //4.回滚操作
            txManager.rollback();
        }finally {
            //5.释放连接
            txManager.release();
        }

    }

    @Override
    public void updateAccount(Account account) {
        try {
            //1.开启事务
            txManager.beginTransaction();
            //2.执行操作
            accountDao.updateAccount(account);
            //3.提交事务
            txManager.commit();
        }catch (Exception e){
            //4.回滚操作
            txManager.rollback();
        }finally {
            //5.释放连接
            txManager.release();
        }

    }

    @Override
    public void deleteAccount(Integer acccountId) {
        try {
            //1.开启事务
            txManager.beginTransaction();
            //2.执行操作
            accountDao.deleteAccount(acccountId);
            //3.提交事务
            txManager.commit();
        }catch (Exception e){
            //4.回滚操作
            txManager.rollback();
        }finally {
            //5.释放连接
            txManager.release();
        }

    }

    @Override
    public void transfer(String sourceName, String targetName, Float money) {
        try {
            //1.开启事务
            txManager.beginTransaction();
            //2.执行操作

            //2.1根据名称查询转出账户
            Account source = accountDao.findAccountByName(sourceName);
            //2.2根据名称查询转入账户
            Account target = accountDao.findAccountByName(targetName);
            //2.3转出账户减钱
            source.setMoney(source.getMoney()-money);
            //2.4转入账户加钱
            target.setMoney(target.getMoney()+money);
            //2.5更新转出账户
            accountDao.updateAccount(source);

            int i=1/0;

            //2.6更新转入账户
            accountDao.updateAccount(target);
            //3.提交事务
            txManager.commit();

        }catch (Exception e){
            //4.回滚操作
            txManager.rollback();
            e.printStackTrace();
        }finally {
            //5.释放连接
            txManager.release();
        }
    }
}
</code></pre><hr>
<pre><code>package com.itheima.utils;

import javax.sql.DataSource;
import java.sql.Connection;

/**
 * @Description 连接的工具类，用于从数据源中获取一个连接，并且实现和线程的绑定
 * @Author TT Hun
 * @Data 2019/10/3 11:22
 */
public class ConnectionUtils {

    private ThreadLocal&lt;Connection&gt; tl = new ThreadLocal&lt;Connection&gt;();
    private DataSource dataSource;


    public void setDataSource(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    /**
     * 获取当前线程上的链接
     *
     * @return
     */
    public Connection getThreadConnection() {
//        1、先从ThreadLocal上获取
        Connection conn = tl.get();
//        2、判断当前线程上是否有链接
        try {
            if (conn == null) {
//        3、从数据源中获取一个连接，并且存入ThreadLocalz中
                conn = dataSource.getConnection();
                tl.set(conn);
            }
//        4、返回当前线程上的连接
            return conn;
        } catch (Exception e) {
            throw new RuntimeException(&quot;报错了&quot;);
        }
    }

    /**
     * 链接和线程解绑
     */
    public void removeConnection(){
        tl.remove();
    }
}
</code></pre><hr>
<pre><code>package com.itheima.utils;

/**
 * @Description 和事务管理相关的工具类，包含了开启事务，提交事务，回滚事务和释放连接的方法
 * @Author TT Hun
 * @Data 2019/10/3 11:35
 */
public class TransactionManager {

    private ConnectionUtils connectionUtils;

    public void setConnectionUtils(ConnectionUtils connectionUtils) {
        this.connectionUtils = connectionUtils;
    }

    /**
     * 开始事务
     */
    public void beginTransaction() {
        try {
            connectionUtils.getThreadConnection().setAutoCommit(false);
        } catch (Exception e) {
            e.printStackTrace();
        }

    }

    /**
     * 提交事务
     */
    public void commit() {
        try {
            connectionUtils.getThreadConnection().commit();
        } catch (Exception e) {
            e.printStackTrace();
        }

    }

    /**
     * 回滚事务
     */
    public void rollback() {
        try {
            connectionUtils.getThreadConnection().rollback();
        } catch (Exception e) {
            e.printStackTrace();
        }

    }

    /**
     * 释放连接事务
     */
    public void release() {
        try {
//            使用服务器也有一个线程池，当tomcat启动时候，会初始化一大堆线程放到一个容器中
//            每次访问都是线程池中拿出来一个线程给我们使用，调用close方法并不是真正的关闭而是将线程还给线程池
            connectionUtils.getThreadConnection().close();
//            所以想要连接和线程解绑，通过这个方法。
            connectionUtils.removeConnection();
        } catch (Exception e) {
            e.printStackTrace();
        }

    }
}
</code></pre><hr>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt;

    &lt;!-- 配置Service --&gt;
    &lt;bean id=&quot;accountService&quot; class=&quot;com.itheima.service.impl.AccountServiceImpl&quot;&gt;
        &lt;!-- 注入dao --&gt;
        &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!--配置Dao对象--&gt;
    &lt;bean id=&quot;accountDao&quot; class=&quot;com.itheima.dao.impl.AccountDaoImpl&quot;&gt;
        &lt;!-- 注入QueryRunner --&gt;
        &lt;property name=&quot;runner&quot; ref=&quot;runner&quot;&gt;&lt;/property&gt;
&lt;!--        注入ConnectionUtils--&gt;
        &lt;property name=&quot;connectionUtils&quot; ref =&quot;connectionUtils&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!--配置QueryRunner--&gt;
    &lt;bean id=&quot;runner&quot; class=&quot;org.apache.commons.dbutils.QueryRunner&quot; scope=&quot;prototype&quot;&gt;
    &lt;/bean&gt;

    &lt;!-- 配置数据源 --&gt;
    &lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;
        &lt;!--连接数据库的必备信息--&gt;
        &lt;property name=&quot;driverClass&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/eesy?characterEncoding=utf8&amp;amp;serverTimezone=UTC&amp;amp;useSSL=false&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;user&quot; value=&quot;root&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;root&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

&lt;!--    配置Connection的工具类 ConnectionUtils--&gt;
    &lt;bean id =&quot;connectionUtils&quot; class =&quot;com.itheima.utils.ConnectionUtils&quot;&gt;
&lt;!--        注入数据源--&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

&lt;!--    配置事务管理器--&gt;
    &lt;bean id=&quot;txManager&quot; class=&quot;com.itheima.utils.TransactionManager&quot;&gt;
&lt;!--        注入ConnectionUtils--&gt;
        &lt;property name=&quot;connectionUtils&quot; ref=&quot;connectionUtils&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;


&lt;!--    配置AOP--&gt;
    &lt;aop:config&gt;
&lt;!--        配置通用的切入点表达式--&gt;
        &lt;aop:pointcut id=&quot;pt1&quot; expression=&quot;execution(* com.itheima.service.impl.*.*(..)))&quot;&gt;&lt;/aop:pointcut&gt;
        &lt;aop:aspect id=&quot;txAdvice&quot; ref=&quot;txManager&quot;&gt;
&lt;!--            配置前置通知，开启事务--&gt;
        &lt;aop:before method=&quot;beginTransaction&quot; pointcut-ref=&quot;pt1&quot;&gt;&lt;/aop:before&gt;
&lt;!--            配置后置通知，提交事务--&gt;
            &lt;aop:after-returning method=&quot;commit&quot; pointcut-ref=&quot;pt1&quot;&gt;&lt;/aop:after-returning&gt;
&lt;!--            配置异常通知，回滚事务--&gt;
            &lt;aop:after-throwing method=&quot;rollback&quot; pointcut-ref=&quot;pt1&quot;&gt;&lt;/aop:after-throwing&gt;
&lt;!--            配置最终通知，释放连接--&gt;
            &lt;aop:after method=&quot;release&quot; pointcut-ref=&quot;pt1&quot;&gt;&lt;/aop:after&gt;
        &lt;/aop:aspect&gt;
    &lt;/aop:config&gt;
&lt;/beans&gt;
</code></pre><hr>
<pre><code>package com.itheima.test;

import com.itheima.domain.Account;
import com.itheima.service.IAccountService;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import java.util.List;

/**
 * 使用Junit单元测试：测试我们的配置
 */
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = &quot;classpath:bean.xml&quot;)
public class AccountServiceTest {

    @Autowired
    private  IAccountService as;

    @Test
    public void testTransfer(){

        as.transfer(&quot;aaa&quot;,&quot;bbb&quot;,100f);
    }
}
</code></pre><hr>
<hr>
<hr>
<p>下面是基于注解的银行转行范例：</p>
<pre><code>package com.itheima.dao;

import com.itheima.domain.Account;

import java.util.List;

/**
 * 账户的持久层接口
 */
public interface IAccountDao {

    /**
     * 查询所有
     * @return
     */
    List&lt;Account&gt; findAllAccount();

    /**
     * 查询一个
     * @return
     */
    Account findAccountById(Integer accountId);

    /**
     * 保存
     * @param account
     */
    void saveAccount(Account account);

    /**
     * 更新
     * @param account
     */
    void updateAccount(Account account);

    /**
     * 删除
     * @param acccountId
     */
    void deleteAccount(Integer acccountId);

    /**
     * 根据名称查账户
     * @param accountName   用户名称
     * @return      如果有唯一结果就返回，如果没有结果就返回Null,结果集超过一个返回异常
     */
    Account findAccountByName(String accountName);
}
</code></pre><hr>
<pre><code>package com.itheima.dao.impl;

import com.itheima.dao.IAccountDao;
import com.itheima.domain.Account;
import com.itheima.utils.ConnectionUtils;
import org.apache.commons.dbutils.QueryRunner;
import org.apache.commons.dbutils.handlers.BeanHandler;
import org.apache.commons.dbutils.handlers.BeanListHandler;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;

import java.util.List;

/**
 * 账户的持久层实现类
 */
@Repository(&quot;accountDao&quot;)
public class AccountDaoImpl implements IAccountDao {

    @Autowired
    private QueryRunner runner;

    @Autowired
    private ConnectionUtils connectionUtils;


    public List&lt;Account&gt; findAllAccount() {
        try{
            return runner.query(connectionUtils.getThreadConnection(),&quot;select * from account&quot;,new BeanListHandler&lt;Account&gt;(Account.class));
        }catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public Account findAccountById(Integer accountId) {
        try{
            return runner.query(connectionUtils.getThreadConnection(),&quot;select * from account where id = ? &quot;,new BeanHandler&lt;Account&gt;(Account.class),accountId);
        }catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public void saveAccount(Account account) {
        try{
            runner.update(connectionUtils.getThreadConnection(),&quot;insert into account(name,money)values(?,?)&quot;,account.getName(),account.getMoney());
        }catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public void updateAccount(Account account) {
        try{
            runner.update(connectionUtils.getThreadConnection(),&quot;update account set name=?,money=? where id=?&quot;,account.getName(),account.getMoney(),account.getId());
        }catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public void deleteAccount(Integer accountId) {
        try{
            runner.update(connectionUtils.getThreadConnection(),&quot;delete from account where id=?&quot;,accountId);
        }catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public Account findAccountByName(String accountName) {
        try{
            List&lt;Account&gt; accounts = runner.query(connectionUtils.getThreadConnection(),&quot;select * from account where name = ? &quot;,new BeanListHandler&lt;Account&gt;(Account.class),accountName);
            if(accounts == null || accounts.size() == 0){
                return null;
            }
            if(accounts.size() &gt; 1){
                throw new RuntimeException(&quot;结果集不唯一，数据有问题&quot;);
            }
            return accounts.get(0);
        }catch (Exception e) {
            throw new RuntimeException(e);
        }
    }
}
</code></pre><hr>
<pre><code>package com.itheima.domain;

import java.io.Serializable;

/**
 * 账户的实体类
 */
public class Account implements Serializable {

    private Integer id;
    private String name;
    private Float money;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Float getMoney() {
        return money;
    }

    public void setMoney(Float money) {
        this.money = money;
    }

    @Override
    public String toString() {
        return &quot;Account{&quot; +
                &quot;id=&quot; + id +
                &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +
                &quot;, money=&quot; + money +
                &apos;}&apos;;
    }
}
</code></pre><hr>
<pre><code>package com.itheima.service;

import com.itheima.domain.Account;

import java.util.List;

/**
 * 账户的业务层接口
 */
public interface IAccountService {

    /**
     * 查询所有
     * @return
     */
    List&lt;Account&gt; findAllAccount();

    /**
     * 查询一个
     * @return
     */
    Account findAccountById(Integer accountId);

    /**
     * 保存
     * @param account
     */
    void saveAccount(Account account);

    /**
     * 更新
     * @param account
     */
    void updateAccount(Account account);

    /**
     * 删除
     * @param acccountId
     */
    void deleteAccount(Integer acccountId);

    /**
     *
     * 转账方法
     * @param sourceName    转出账户名称
     * @param targetName    转入账户名称
     * @param money         转账金额
     */
    void transfer(String sourceName, String targetName, Float money);


}
</code></pre><hr>
<pre><code>package com.itheima.service.impl;

import com.itheima.dao.IAccountDao;
import com.itheima.domain.Account;
import com.itheima.service.IAccountService;
import com.itheima.utils.TransactionManager;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

/**
 * 账户的业务层实现类
 *
 * 事务控制应该都是在业务层
 */
@Service(&quot;accountService&quot;)
public class AccountServiceImpl implements IAccountService{

    @Autowired//dao自动按照类型注入
    private IAccountDao accountDao;
    @Autowired
    private TransactionManager txManager;


    public List&lt;Account&gt; findAllAccount() {
        try {
            //1.开启事务
            txManager.beginTransaction();
            //2.执行操作
            List&lt;Account&gt; accounts = accountDao.findAllAccount();
            //3.提交事务
            txManager.commit();
            //4.返回结果
            return accounts;
        }catch (Exception e){
            //5.回滚操作
            txManager.rollback();
            throw new RuntimeException(e);
        }finally {
            //6.释放连接
            txManager.release();
        }

    }

    @Override
    public Account findAccountById(Integer accountId) {
        try {
            //1.开启事务
            txManager.beginTransaction();
            //2.执行操作
            Account account = accountDao.findAccountById(accountId);
            //3.提交事务
            txManager.commit();
            //4.返回结果
            return account;
        }catch (Exception e){
            //5.回滚操作
            txManager.rollback();
            throw new RuntimeException(e);
        }finally {
            //6.释放连接
            txManager.release();
        }
    }

    @Override
    public void saveAccount(Account account) {
        try {
            //1.开启事务
            txManager.beginTransaction();
            //2.执行操作
            accountDao.saveAccount(account);
            //3.提交事务
            txManager.commit();
        }catch (Exception e){
            //4.回滚操作
            txManager.rollback();
        }finally {
            //5.释放连接
            txManager.release();
        }

    }

    @Override
    public void updateAccount(Account account) {
        try {
            //1.开启事务
            txManager.beginTransaction();
            //2.执行操作
            accountDao.updateAccount(account);
            //3.提交事务
            txManager.commit();
        }catch (Exception e){
            //4.回滚操作
            txManager.rollback();
        }finally {
            //5.释放连接
            txManager.release();
        }

    }

    @Override
    public void deleteAccount(Integer acccountId) {
        try {
            //1.开启事务
            txManager.beginTransaction();
            //2.执行操作
            accountDao.deleteAccount(acccountId);
            //3.提交事务
            txManager.commit();
        }catch (Exception e){
            //4.回滚操作
            txManager.rollback();
        }finally {
            //5.释放连接
            txManager.release();
        }

    }

    @Override
    public void transfer(String sourceName, String targetName, Float money) {
        try {
            //1.开启事务
            txManager.beginTransaction();
            //2.执行操作

            //2.1根据名称查询转出账户
            Account source = accountDao.findAccountByName(sourceName);
            //2.2根据名称查询转入账户
            Account target = accountDao.findAccountByName(targetName);
            //2.3转出账户减钱
            source.setMoney(source.getMoney()-money);
            //2.4转入账户加钱
            target.setMoney(target.getMoney()+money);
            //2.5更新转出账户
            accountDao.updateAccount(source);

//            int i=1/0;

            //2.6更新转入账户
            accountDao.updateAccount(target);
            //3.提交事务
            txManager.commit();

        }catch (Exception e){
            //4.回滚操作
            txManager.rollback();
            e.printStackTrace();
        }finally {
            //5.释放连接
            txManager.release();
        }


    }
}
</code></pre><hr>
<pre><code>package com.itheima.utils;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import javax.sql.DataSource;
import java.sql.Connection;

/**
 * @Description 连接的工具类，用于从数据源中获取一个连接，并且实现和线程的绑定
 * @Author TT Hun
 * @Data 2019/10/3 11:22
 */

@Component(&quot;connectionUtils&quot;)
public class ConnectionUtils {
    private ThreadLocal&lt;Connection&gt; tl = new ThreadLocal&lt;Connection&gt;();
    @Autowired
    private DataSource dataSource;



    public void setDataSource(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    /**
     * 获取当前线程上的链接
     *
     * @return
     */
    public Connection getThreadConnection() {
//        1、先从ThreadLocal上获取
        Connection conn = tl.get();
//        2、判断当前线程上是否有链接
        try {
            if (conn == null) {
//        3、从数据源中获取一个连接，并且存入ThreadLocalz中
                conn = dataSource.getConnection();
                tl.set(conn);
            }
//        4、返回当前线程上的连接
            return conn;
        } catch (Exception e) {
            throw new RuntimeException(&quot;报错了&quot;);
        }
    }

    /**
     * 链接和线程解绑
     */
    public void removeConnection() {
        tl.remove();
    }
}
</code></pre><hr>
<pre><code>package com.itheima.utils;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.*;
import org.junit.AfterClass;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import javax.management.relation.RoleUnresolved;

/**
 * @Description 和事务管理相关的工具类，包含了开启事务，提交事务，回滚事务和释放连接的方法
 * @Author TT Hun
 * @Data 2019/10/3 11:35
 */
@Component(&quot;txManager&quot;)
@Aspect//配置切面，表示当前类是一个切面类
public class TransactionManager {

    @Autowired
    private ConnectionUtils connectionUtils;

    @Pointcut(&quot;execution(* com.itheima.service.impl.*.*(..))&quot;)//切入点表达式
    private void pt1(){}
    /**
     * 开始事务
     */
//    @Before(&quot;pt1()&quot;)不写这个因为配置注解开发会导致首先出发before然后出发release最后出发commit
    public void beginTransaction() {
        try {
            connectionUtils.getThreadConnection().setAutoCommit(false);
        } catch (Exception e) {
            e.printStackTrace();
        }

    }

    /**
     * 提交事务
     */
//    @AfterReturning(&quot;pt1()&quot;)不写这个因为配置注解开发会导致首先出发before然后出发release最后出发commit
    public void commit() {
        try {
            connectionUtils.getThreadConnection().commit();
        } catch (Exception e) {
            e.printStackTrace();
        }

    }

    /**
     * 回滚事务
     */
//    @AfterReturning(&quot;pt1()&quot;)不写这个因为配置注解开发会导致首先出发before然后出发release最后出发commit
    public void rollback() {
        try {
            connectionUtils.getThreadConnection().rollback();
        } catch (Exception e) {
            e.printStackTrace();
        }

    }

    /**
     * 释放连接事务
     */
//    @After(&quot;pt1()&quot;)不写这个因为配置注解开发会导致首先出发before然后出发release最后出发commit
    public void release() {
        try {
//            使用服务器也有一个线程池，当tomcat启动时候，会初始化一大堆线程放到一个容器中
//            每次访问都是线程池中拿出来一个线程给我们使用，调用close方法并不是真正的关闭而是将线程还给线程池
            connectionUtils.getThreadConnection().close();
//            所以想要连接和线程解绑，通过这个方法。
            connectionUtils.removeConnection();
        } catch (Exception e) {
            e.printStackTrace();
        }

    }

    @Around(&quot;pt1()&quot;)
    public Object aroundAdvice(ProceedingJoinPoint pjp){
        Object rtValue = null;
        try{
//           1、获取参数
           Object[] args = pjp.getArgs();
//           2、开启事务
            this.beginTransaction();
//           3、执行方法
            rtValue = pjp.proceed(args);
//            4、提交事务
            this.commit();
//            5、返回结果
            return rtValue;
        }catch(Throwable e){
//            回滚事务
            this.rollback();
            throw new RuntimeException(e);
        }
        finally{
//           释放资源
            this.release();

        }
    }
}
</code></pre><hr>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;


&lt;!--    配置Spring创建容器时需要扫描的包--&gt;
    &lt;context:component-scan base-package=&quot;com.itheima&quot;&gt;&lt;/context:component-scan&gt;

    &lt;!--配置QueryRunner--&gt;
    &lt;bean id=&quot;runner&quot; class=&quot;org.apache.commons.dbutils.QueryRunner&quot; scope=&quot;prototype&quot;&gt;
    &lt;/bean&gt;

    &lt;!-- 配置数据源 --&gt;
    &lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;
        &lt;!--连接数据库的必备信息--&gt;
        &lt;property name=&quot;driverClass&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/eesy?characterEncoding=utf8&amp;amp;serverTimezone=UTC&amp;amp;useSSL=false&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;user&quot; value=&quot;root&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;root&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

&lt;!--开启Spring对注解AOP的支持--&gt;
    &lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt;
&lt;/beans&gt;
</code></pre><hr>
<pre><code>package com.itheima.test;

        import com.itheima.domain.Account;
        import com.itheima.service.IAccountService;
        import org.junit.Test;
        import org.junit.runner.RunWith;
        import org.springframework.beans.factory.annotation.Autowired;
        import org.springframework.beans.factory.annotation.Qualifier;
        import org.springframework.test.context.ContextConfiguration;
        import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

        import java.util.List;

/**
 * 使用Junit单元测试：测试我们的配置
 */
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = &quot;classpath:bean.xml&quot;)
public class AccountServiceTest {

    @Autowired
    private  IAccountService as;

    @Test
    public void testTransfer(){

        as.transfer(&quot;aaa&quot;,&quot;bbb&quot;,100f);
    }
}
</code></pre><hr>
<hr>
<hr>
<p>在注解配置银行案例的情况下，有一个小问题就是Spring容器自己配置事务的时候会有一个BUG，就是他会首先执行1、connect 2、release3、提交。所以通过配置环绕注解来解决这个问题，环绕注解也就是注解都是自己配置的。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://erichunn.github.io/2019/10/05/Spring第四天_JdbcTemplate的基本使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Eric Hunn">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="无心是一首歌">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/05/Spring第四天_JdbcTemplate的基本使用/" itemprop="url">Spring第四天_JdbcTemplate的基本使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-05T11:14:07+08:00">
                2019-10-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>类似于dbutils</p>
<p><img src="https://i.imgur.com/QDvo9Qn.png" alt=""></p>
<p><img src="https://i.imgur.com/pnXb7t8.png" alt=""></p>
<p><img src="https://i.imgur.com/dSH5jGy.png" alt=""></p>
<p>下面是代码，我们可以通过IOC和AOP动态代理来简化这些代码。使代码更加灵活</p>
<p><img src="https://i.imgur.com/kdScX2O.png" alt=""></p>
<hr>
<p><strong>小tips：</strong></p>
<p>在使用query找到哪个是需要的方法：比如下面的这段，要找的是使用query带哪个参数的方法，先看有的返回void的有的返回List的，也就是Spring的Template是靠不同的query返回不同类型的东西，而dbUtils的query方法是靠ResultSetHandler的返回值来决定返回的内容的，</p>
<p>下面这个方法有这么多重载的方法，如何去定位：</p>
<p><img src="https://i.imgur.com/KGA79w8.png" alt=""></p>
<p>1、我们有什么：我们有SQL语句，语句的参数，</p>
<p>2、我们要什么：我们要一个返回的List集合</p>
<p>T类型和void类型直接就排除，然后第一个参数不是SQL语句的直接排除，然后RowMapper没有参数直接排除，一般参数就是可变参数和数组</p>
<p>所以最后剩下如下下图所示：<br><img src="https://i.imgur.com/lzCNz0V.png" alt=""></p>
<p>dbUtils的和Spring的对比：</p>
<p><img src="https://i.imgur.com/WmJnhQn.png" alt=""></p>
<hr>
<p>然后讲解一下JdbcTemplate的基本用法：</p>
<p>首先是bean.xml文件：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:util=&quot;http://www.springframework.org/schema/util&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd&quot;&gt;


&lt;!--    配置jdbctemplate--&gt;
    &lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

&lt;!--    配置数据源--&gt;
    &lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306_eesy&quot;&gt;
        &lt;/property&gt;
        &lt;property name=&quot;username&quot; value=&quot;root&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;root&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre><p>然后是定义的domain文件：</p>
<pre><code>package com.itheima.domain;

import java.io.Serializable;

/**
 * @Description 账户的实体类
 * @Author TT Hun
 * @Data 2019/10/5 11:28
 */
public class Account implements Serializable {
    private Integer id;
    private String name;
    private Float money;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Float getMoney() {
        return money;
    }

    public void setMoney(Float money) {
        this.money = money;
    }

    @Override
    public String toString() {
        return &quot;Account{&quot; +
                &quot;id=&quot; + id +
                &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +
                &quot;, money=&quot; + money +
                &apos;}&apos;;
    }
}
</code></pre><p>然后是几个JdbcTemplate的Demo</p>
<pre><code>package com.itheima.jdbctemplate;

import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.datasource.DriverManagerDataSource;

/**
 * @Description JDBCTemplate最基本用法
 * @Author TT Hun
 * @Data 2019/10/5 11:30
 */
public class JdbcTemplateDemo1 {
    public static void main(String[] args) {

//        准备数据源，Spring的内置数据源不通过Spring容器，来设置内置数据源。
        DriverManagerDataSource ds = new DriverManagerDataSource();
        ds.setDriverClassName(&quot;com.mysql.jdbc.Driver&quot;);
        ds.setUrl(&quot;jdbc:mysql://localhost:3306/eesy&quot;);
        ds.setUsername(&quot;root&quot;);
        ds.setPassword(&quot;root&quot;);
//        1、创建JDBCTemplate对象
        JdbcTemplate jt = new JdbcTemplate();
//        给jt设置数据源
        jt.setDataSource(ds);
//         2、执行操作
        jt.execute(&quot;insert into account(name,money) values(&apos;ccc&apos;,1000f)&quot;);

    }
}
</code></pre><hr>
<pre><code>package com.itheima.jdbctemplate;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.datasource.DriverManagerDataSource;

/**
 * @Description JDBCTemplate最基本用法，通过Spring容器IOC，来获取对象。
 * @Author TT Hun
 * @Data 2019/10/5 11:30
 */
public class JdbcTemplateDemo2 {
    public static void main(String[] args) {

//        1、获取容器
        ApplicationContext ac = new ClassPathXmlApplicationContext(&quot;bean.xml&quot;);
//        2、获取对象
        JdbcTemplate jt = ac.getBean(&quot;jdbcTemplate&quot;, JdbcTemplate.class);
//        3、添加操作
        jt.execute(&quot;insert into account(name,money) values(&apos;ddd&apos;,222f)&quot;);




    }
}
</code></pre><hr>
<pre><code>package com.itheima.jdbctemplate;

import com.itheima.domain.Account;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import org.springframework.jdbc.core.BeanPropertyRowMapper;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.List;

/**
 * @Description JDBCTemplate的CRUD用法
 * @Author TT Hun
 * @Data 2019/10/5 11:30
 */
public class JdbcTemplateDemo3 {
    public static void main(String[] args) {

//        1、获取容器
        ApplicationContext ac = new ClassPathXmlApplicationContext(&quot;bean.xml&quot;);
//        2、获取对象
        JdbcTemplate jt = ac.getBean(&quot;jdbcTemplate&quot;, JdbcTemplate.class);
//        3、执行操作
//        保存操作
        jt.update(&quot;insert into account(name,money)values(?,?)&quot;,&quot;eee&quot;,3333f);
//        更新操作
        jt.update(&quot;update acocunt set name = ?,money = ?,where id=?&quot;,&quot;test&quot;,4567,7);
//        删除操作
        jt.update(&quot;delete from account where id=?&quot;,8);
//        查询所有
//        List&lt;Account&gt; accounts = jt.query(&quot;select * from account where money &gt;?&quot;, new AccountRowMapper() , 1000f);
//        下面这种方法不使用自己定义的结果集，而使用Spring自带的结果集即可。
        List&lt;Account&gt; accounts = jt.query(&quot;select * from account where money&gt;?&quot;, new BeanPropertyRowMapper&lt;Account&gt;(Account.class) , 1000f);
        for (Account account:accounts){
            System.out.println(account);
        }

//        查询一个
        List&lt;Account&gt; account = jt.query(&quot;select * from account where id=?&quot;, new BeanPropertyRowMapper&lt;Account&gt;(Account.class) , 1);
        System.out.println(accounts.isEmpty()? &quot;没有内容&quot;:accounts.get(0));
//        查询返回一行一列(使用聚合函数但是不加groupby字句)
        List&lt;Long&gt; count = jt.queryForList(&quot;select count(*) from account where money &gt; ? &quot;, Long.class, 100000f);
        System.out.println(count);
    }
}

/**
 * 定义Account的封装策略的
 */
class AccountRowMapper implements RowMapper&lt;Account&gt; {

    /**
     * 把结果集中的数据封装到Account中然后由Spring把每个Account加到集合中
     * @param rs
     * @param rowNum
     * @return
     * @throws SQLException
     */
    public Account mapRow(ResultSet rs, int rowNum) throws SQLException {
        Account account = new Account();
        account.setId(rs.getInt(&quot;id&quot;));
        account.setName(rs.getString(&quot;name&quot;));
        account.setMoney(rs.getFloat(&quot;money&quot;));
        return account;
    }
}
</code></pre><hr>
<p>测试类使用Dao层的操作：</p>
<pre><code>import com.itheima.dao.IAccountDao;
import com.itheima.domain.Account;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import org.springframework.jdbc.core.JdbcTemplate;

/**
 * @Description JDBCTemplate最基本用法，通过Spring容器IOC，来获取对象。
 * @Author TT Hun
 * @Data 2019/10/5 11:30
 */
public class test {
    public static void main(String[] args) {

//        1、获取容器
        ApplicationContext ac = new ClassPathXmlApplicationContext(&quot;bean.xml&quot;);
//        2、获取对象
//        JdbcTemplate accountDao = ac.getBean(&quot;jdbcTemplate&quot;, JdbcTemplate.class);
//        3、添加操作
//        jt.execute(&quot;insert into account(name,money) values(&apos;ddd&apos;,222f)&quot;);
        IAccountDao ad = ac.getBean(&quot;accountDao&quot;, IAccountDao.class);
        Account account = ad.findAccountById(1);
        System.out.println(account);

    }
}
</code></pre><p>和上面测试类一起的</p>
<pre><code>package com.itheima.dao.impl;

import com.itheima.dao.IAccountDao;
import com.itheima.domain.Account;
import org.springframework.jdbc.core.BeanPropertyRowMapper;
import org.springframework.jdbc.core.JdbcTemplate;

import java.util.List;

/**
 * @Description 账户的持久层实现类
 * @Author TT Hun
 * @Data 2019/10/8 21:05
 */
public class AccountDaoImpl implements IAccountDao {


    private JdbcTemplate jdbcTemplate;

    public void setJdbcTemplate(JdbcTemplate jdbcTemplate) {
        this.jdbcTemplate = jdbcTemplate;
    }

    public Account findAccountById(Integer accountId) {
         List&lt;Account&gt; accounts = jdbcTemplate.query(&quot;select * from account where id = ? &quot;,new BeanPropertyRowMapper&lt;Account&gt;(Account.class),accountId);
         return accounts.isEmpty()? null:accounts.get(0);
    }

    public Account findAccountByName(String accountName) {
        List&lt;Account&gt; accounts = jdbcTemplate.query(&quot;select * from account where name = ? &quot;,new BeanPropertyRowMapper&lt;Account&gt;(Account.class),accountName);
        if(accounts.isEmpty()){
            return null;
        }
        if(accounts.size()&gt;1){
            throw new RuntimeException(&quot;结果集不唯一&quot;);
        }
        return accounts.get(0);
    }

    public void updateAccount(Account account) {
        jdbcTemplate.update(&quot;update account set name=?,money = ? where id = ?&quot;,account.getName(),account.getMoney(),account.getId());


    }
}
</code></pre><hr>
<hr>
<hr>
<p>通常情况下，不仅仅有一个AccountDaoImpl，还会有有一些其他的impl，比如用户的。。之类的。<br>所以需要把重复代码抽取出来也就是让他们继承一个父类，父类中写好了重复代码即可：</p>
<p><img src="https://i.imgur.com/uoAnOLH.png" alt=""></p>
<p>也就是通过继承的方式实现重复代码的抽取，一种是注入dataSource一种是注入JdbcTemplate</p>
<p><img src="https://i.imgur.com/7ukvCYs.png" alt=""></p>
<p>除了字节写继承父类的方式解决这个问题，还可以通过Spring自带的一个类来解决，直接继承jdbcDaoSupport类即可。<br><img src="https://i.imgur.com/939epiM.png" alt=""></p>
<p>也就是说根本不需要自己写这个父类，直接继承Spring自带的父类即可。</p>
<p>所以，现在有2种写法，一种是继承父类，一种是成员变量，区别是：<br>继承的方法适合用xml文件配置的方式来写，而写成员变量适合用注解的方式来开发；<br>而继承父类因为父类在jar包里面，所以不能注入。<br><img src="https://i.imgur.com/lGpsHsd.png" alt=""><br><img src="https://i.imgur.com/QH8Ltnm.png" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://erichunn.github.io/2019/10/04/Spring第三天-面向切片编程AOP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Eric Hunn">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="无心是一首歌">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/04/Spring第三天-面向切片编程AOP/" itemprop="url">Spring第三天天_面向切片编程AOP</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-04T09:40:21+08:00">
                2019-10-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SpringAOP/" itemprop="url" rel="index">
                    <span itemprop="name">SpringAOP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://i.imgur.com/X6RlFpQ.png" alt=""></p>
<p><img src="https://i.imgur.com/Bd6rf5q.png" alt=""></p>
<p>下图：开始配置serviceimpl到容器中，在配置Logger类，然后配置AOP，将logger类配置到AOP中，<br>配置通知类型，建立通知方法和切入点关联，就是用printLog方法执行在AccountServiceimpl.saveAccount()方法前面。也就是每次执行那个saveAccount方法时候，都要通过prinLog方法，也就是使用动态代理完成</p>
<p><img src="https://i.imgur.com/uN37a9u.png" alt=""></p>
<hr>
<hr>
<hr>
<pre><code>package com.itheima.service;

/**
 * @Description 账户的业务层接口
 * @Author TT Hun
 * @Data 2019/10/4 17:31
 */
public interface IAccountService {

    /**
     * 模拟保存账户
     */
    void saveAccount();

    /**
     * 模拟更新账户
     */
    void updateAccount(int i);

    /**
     * 模拟删除账户
     * @return
     */
    int deleteAccount();
}
</code></pre><hr>
<pre><code>package com.itheima.service.impl;

import com.itheima.service.IAccountService;

/**
 * @Description TODO
 * @Author TT Hun
 * @Data 2019/10/4 17:35
 */
public class accountServiceImpl implements IAccountService {
    public void saveAccount() {
        System.out.println(&quot;执行了保存&quot; );

    }

    public void updateAccount(int i) {
    System.out.println(&quot;执行了更新&quot; + i );
    }

    public int deleteAccount() {
        System.out.println(&quot;执行了删除&quot;);
        return 0;
    }
}
</code></pre><hr>
<pre><code>package com.itheima.utils;

/**
 * @Description 用于记录日志的工具类，提供了公共的代码
 * @Author TT Hun
 * @Data 2019/10/4 17:37
 */
public class Logger {
    /**
     * 用于打印日志，计划让其在切入点方法之前执行（切入点方法就是我们的业务层昂法）
     */
    public void printLog(){
        System.out.println(&quot;Logger类中的Printlog方法开始记录日志了&quot;);
    }
}
</code></pre><hr>
<p>bean.xml文件配置：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt;

&lt;!--    配置Springioc把service对象配置进来--&gt;
    &lt;bean id=&quot;accountService&quot; class=&quot;com.itheima.service.impl.accountServiceImpl&quot;&gt;&lt;/bean&gt;
&lt;!--    spring中基于xml的AOP配置步骤--&gt;
&lt;!--    1、把通知的bean也交给Spring来管理--&gt;
&lt;!--    2、使用aopconfig标签表明开始AOP的配置
        3、使用aop:aspect的标签表明配置切面
                id属性：是给切面提供一个唯一标识
                ref属性：指定通知类bean的id
         4、在aop:aspect标签的内部使用对应的标签来配置通知的类型
                我们现在示例是让printlog方法在切入点方法之前执行，所以是前置通知
                使用aop:before标签表示配置前置通知
                method属性用于指定logger类中哪个方法是前置通知
                pointcut属性：用于指定切入点表达式，该表达式的含义指的是对业务层中那些方法进行增强
                切入点表达式的写法：
                关键字：execution(表达式)
                表达式写法：
                访问修饰符   返回值  包名.包名.包名......类名.方法名(参数列表)
                标准表达式写法：
                        public void com.itheima.service.impl.AccountServiceImpl.saveAccount()
                返回值可以使用通配符表示任意返回值
                        全通配切入点表达式写法、返回值是*然后所有的也是*：
                            * *..*.*(..)
                         包名可以使用..表示当前包及其子包。表示所有包下面只要有这个方法的
                            * *..AccountServiceImpl.saveAccount()
                         类名和方法名都可以使用*来实现通配
                         * *..*.*()
                         参数列表，可以直接写数据类型：
                                基本类型直接写名称               int
                                引用类型写包名.类名的方式       java.lang.String
                                可以使用通配符表示任意类型，但是必须有参数 *

                         实际开发中切入点表达式额通常写法：
                                切到业务层实现类下的所有方法
                                * com.itheima.service.impl.*.*(..)

                --&gt;
&lt;!--    配置logger类--&gt;
    &lt;bean id=&quot;logger&quot; class=&quot;com.itheima.utils.Logger&quot;&gt;&lt;/bean&gt;

&lt;!--    配置Aop--&gt;
    &lt;aop:config&gt;
&lt;!--        配置切面--&gt;
        &lt;aop:aspect id=&quot;logAdvice&quot; ref=&quot;logger&quot;&gt;
&lt;!--            配置通知的类型且建立通知方法和切入点方法的关联--&gt;
            &lt;aop:before method=&quot;printLog&quot; pointcut=&quot;execution(* com.itheima.service.impl.*.*(..))&quot;&gt;&lt;/aop:before&gt;
        &lt;/aop:aspect&gt;
    &lt;/aop:config&gt;
    &lt;/beans&gt;
</code></pre><hr>
<hr>
<hr>
<p>下面是前置通知、后置通知、异常通知、最终通知在AOP里面的配置</p>
<p><img src="https://i.imgur.com/SQA6PUp.png" alt=""></p>
<p><img src="https://i.imgur.com/Bd6rf5q.png" alt=""></p>
<hr>
<p><strong>环绕通知的配置</strong>：</p>
<p>在xml文件里面吧前置、后置、异常、最终都注释掉。然后在Logger类中通过代码控制，实现动态代理，解决前置，后置，异常，最终的问题。也就是除了通过配置xml文件中配置实现这些，也可以靠自己编码实现</p>
<p>1、实现bean.xml文件只保留环绕的切面配置：</p>
<p><img src="https://i.imgur.com/ZRoQGKr.png" alt=""></p>
<p>2、在Logger里面aroundPringLog()方法写前置后置等。</p>
<pre><code>package com.itheima.utils;

import org.aspectj.lang.ProceedingJoinPoint;

/**
 * @Description 用于记录日志的工具类，提供了公共的代码
 * @Author TT Hun
 * @Data 2019/10/4 17:37
 */
public class Logger {
    /**
     * 后置通知
     */
    public void afterReturningPrintLog() {
        System.out.println(&quot;后置通知Logger类中的afterReturningPrintLog方法开始记录日志了&quot;);
    }

    /**
     * 前置通知
     */
    public void beforePrintLog() {
        System.out.println(&quot;前置通知Logger类中的Printlog方法开始记录日志了&quot;);
    }

    /**
     * 异常通知
     */
    public void afterThrowingPrintLog() {
        System.out.println(&quot;异常通知Logger类中的afterThrowingPrintLog方法开始记录日志了&quot;);
    }

    /**
     * 最终通知
     */
    public void afterPrintLog() {
        System.out.println(&quot;最终通知Logger类中的afterPrintLog方法开始记录日志了&quot;);
    }

    /**
     * 环绕通知
     * 问题：当我们配置了环绕通知之后切入点方法没有执行，而通知方法执行了。
     * 分析：通过对比动态代理中的环绕通知代码，发现动态代理中的环绕通知有明确的切入点方法调用，而我们的代码中没有。
     * 解决：
     *          Spring框架为我们提供了一个接口：ProceedingJoinPoint。该接口有一个方法叫proceed(),此方法就相当于明确调用切入点方法。
     *          该接口可以作为环绕通知的方法参数，在程序执行时候，spring框架会为我们提供该接口的实现类供我们使用。
     *
     *  Spring中的环绕通知：
     *          他是spring框架为我们提供的一种方式：可以在代码中手动控制增强方法何时执行的方式。
     *
     *
     *          也就是除了配置在bean.xml文件中，实现动态代理，解决前置，后置，异常，最终的问题
     *          也可以通过代码控制的方式。
     */
    public Object aroundPringLog(ProceedingJoinPoint pjp){
        Object rtValue = null;
        try {
            System.out.println(&quot;Logger类中的afterPrintLog方法开始记录日志了。。。前置&quot;);
           rtValue = pjp.getArgs();//得到方法执行所需要的参数
            System.out.println(&quot;Logger类中的afterPrintLog方法开始记录日志了。。。后置&quot;);
            pjp.proceed();//明确调用业务层方法，也叫切入点方法
            return rtValue;
        } catch (Throwable t) {
            System.out.println(&quot;Logger类中的afterPrintLog方法开始记录日志了。。。异常&quot;);
            throw  new RuntimeException();
        }
        finally {
            System.out.println(&quot;Logger类中的afterPrintLog方法开始记录日志了。。。最终&quot;);

        }
    }

}
</code></pre><hr>
<h1 id="Spring基于注解的AOP配置"><a href="#Spring基于注解的AOP配置" class="headerlink" title="Spring基于注解的AOP配置"></a>Spring基于注解的AOP配置</h1><p>首先使用注解的AOP配置会有一个问题：就是这几个通知的顺序问题。有可能顺序错乱，这个是Spring自己的问题：</p>
<p><img src="https://i.imgur.com/eaaNP9W.png" alt=""></p>
<p>但是使用环绕通知是没有这个问题的：</p>
<p><img src="https://i.imgur.com/6Ht4ifM.png" alt=""></p>
<p>所以如果使用注解AOP的话建议使用环绕模式的：</p>
<p>完整代码如下：</p>
<pre><code>package com.itheima.service.impl;

import com.itheima.service.IAccountService;
import org.springframework.stereotype.Service;

/**
 * @Description TODO
 * @Author TT Hun
 * @Data 2019/10/4 17:35
 */
@Service(&quot;accountService&quot;)
public class accountServiceImpl implements IAccountService {
    public void saveAccount() {
        System.out.println(&quot;执行了保存&quot; );

    }

    public void updateAccount(int i) {
    System.out.println(&quot;执行了更新&quot; + i );
    }

    public int deleteAccount() {
        System.out.println(&quot;执行了删除&quot;);
        return 0;
    }
}
</code></pre><hr>
<pre><code>package com.itheima.service;

/**
 * @Description 账户的业务层接口
 * @Author TT Hun
 * @Data 2019/10/4 17:31
 */
public interface IAccountService {

    /**
     * 模拟保存账户
     */
    void saveAccount();

    /**
     * 模拟更新账户
     */
    void updateAccount(int i);

    /**
     * 模拟删除账户
     * @return
     */
    int deleteAccount();
}
</code></pre><hr>
<pre><code>package com.itheima.utils;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.*;
import org.springframework.stereotype.Component;

/**
 * @Description 用于记录日志的工具类，提供了公共的代码
 * @Author TT Hun
 * @Data 2019/10/4 17:37
 */
@Component(&quot;Logger&quot;)
@Aspect//表示当前类是一个切面类
public class Logger {

    @Pointcut(&quot;execution(* com.itheima.service.impl.*.*())&quot;)
    private void pt1(){}
    /**
     * 后置通知
     */
    @AfterReturning(&quot;pt1()&quot;)
    public void afterReturningPrintLog() {
        System.out.println(&quot;后置通知Logger类中的afterReturningPrintLog方法开始记录日志了&quot;);
    }

    /**
     * 前置通知
     */
    @Before(&quot;pt1()&quot;)
    public void beforePrintLog() {
        System.out.println(&quot;前置通知Logger类中的Printlog方法开始记录日志了&quot;);
    }

    /**
     * 异常通知
     */
    @AfterThrowing(&quot;pt1()&quot;)
    public void afterThrowingPrintLog() {
        System.out.println(&quot;异常通知Logger类中的afterThrowingPrintLog方法开始记录日志了&quot;);
    }

    /**
     * 最终通知
     */
    @After(&quot;pt1()&quot;)
    public void afterPrintLog() {
        System.out.println(&quot;最终通知Logger类中的afterPrintLog方法开始记录日志了&quot;);
    }

    /**
     * 环绕通知
     * 问题：当我们配置了环绕通知之后切入点方法没有执行，而通知方法执行了。
     * 分析：通过对比动态代理中的环绕通知代码，发现动态代理中的环绕通知有明确的切入点方法调用，而我们的代码中没有。
     * 解决：
     *          Spring框架为我们提供了一个接口：ProceedingJoinPoint。该接口有一个方法叫proceed(),此方法就相当于明确调用切入点方法。
     *          该接口可以作为环绕通知的方法参数，在程序执行时候，spring框架会为我们提供该接口的实现类供我们使用。
     *
     *  Spring中的环绕通知：
     *          他是spring框架为我们提供的一种方式：可以在代码中手动控制增强方法何时执行的方式。
     *
     *
     *          也就是除了配置在bean.xml文件中，实现动态代理，解决前置，后置，异常，最终的问题
     *          也可以通过代码控制的方式。
     */
//    @Around(&quot;pt1()&quot;)
    public Object aroundPringLog(ProceedingJoinPoint pjp){
        Object rtValue = null;
        try {
            System.out.println(&quot;Logger类中的afterPrintLog方法开始记录日志了。。。前置&quot;);
           rtValue = pjp.getArgs();//得到方法执行所需要的参数
            System.out.println(&quot;Logger类中的afterPrintLog方法开始记录日志了。。。后置&quot;);
            pjp.proceed();//明确调用业务层方法，也叫切入点方法
            return rtValue;
        } catch (Throwable t) {
            System.out.println(&quot;Logger类中的afterPrintLog方法开始记录日志了。。。异常&quot;);
            throw  new RuntimeException();
        }
        finally {
            System.out.println(&quot;Logger类中的afterPrintLog方法开始记录日志了。。。最终&quot;);

        }
    }

}
</code></pre><hr>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;!-- 配置spring创建容器时要扫描的包--&gt;
    &lt;context:component-scan base-package=&quot;com.itheima&quot;&gt;&lt;/context:component-scan&gt;

    &lt;!-- 配置spring开启注解AOP的支持 --&gt;
    &lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt;
&lt;/beans&gt;
</code></pre><hr>
<pre><code>package com.itheima;

import com.itheima.service.IAccountService;
import javafx.application.Application;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

/**
 * @Description 测试AOP的配置
 * @Author TT Hun
 * @Data 2019/10/4 18:58
 */
public class test {
    public static void main(String[] args) {
//        获取容器
        ApplicationContext ac = new ClassPathXmlApplicationContext(&quot;bean.xml&quot;);
//        2、获取对象
        IAccountService as = (IAccountService)ac.getBean(&quot;accountService&quot;);
//        3、执行方法
        as.saveAccount();

}
}
</code></pre><hr>
<hr>
<hr>
<p>总结内容：<br>1、从银行转行入手<br>由于加了事务，导致非常麻烦，重复代码非常多，首先：</p>
<p>第一步是将重复的代码，事务的解决抽取出来，</p>
<p>然后：是将代码通过动态代理加入到源代码中，动态代理的好处是可以不改变源码的基础上，对已有的代码进行增强。</p>
<p>然后讲解了两种动态代理方式：一种基于子类的动态代理，一种基于接口的动态代理。</p>
<p>再后，通过Springaop实现动态代理。这里面有一些术语需要消化。</p>
<p><img src="https://i.imgur.com/1P9AwN6.png" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://erichunn.github.io/2019/10/02/Spring第三天-银行转账案例/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Eric Hunn">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="无心是一首歌">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/02/Spring第三天-银行转账案例/" itemprop="url">Spring第三天_银行转账案例</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-02T22:39:06+08:00">
                2019-10-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://i.imgur.com/KTxFDiv.png" alt=""></p>
<p>数据库配置问题：<br>在bean.xml文件里面写配置的时候，中间要加分号图1是正确的图2是错误的<br><img src="https://i.imgur.com/55lCGQC.png" alt=""></p>
<p><img src="https://i.imgur.com/6fQopwA.png" alt=""></p>
<hr>
<pre><code>package com.itheima.dao;

import com.itheima.domain.Account;

import java.util.List;

/**
 * 账户的持久层接口
 */
public interface IAccountDao {

    /**
     * 查询所有
     * @return
     */
    List&lt;Account&gt; findAllAccount();

    /**
     * 查询一个
     * @return
     */
    Account findAccountById(Integer accountId);

    /**
     * 保存
     * @param account
     */
    void saveAccount(Account account);

    /**
     * 更新
     * @param account
     */
    void updateAccount(Account account);

    /**
     * 删除
     * @param acccountId
     */
    void deleteAccount(Integer acccountId);

    /**
     * 根据名称查账户
     * @param accountName   用户名称
     * @return      如果有唯一结果就返回，如果没有结果就返回Null,结果集超过一个返回异常
     */
    Account findAccountByName(String accountName);
}
</code></pre><hr>
<pre><code>package com.itheima.dao.impl;

import com.itheima.dao.IAccountDao;
import com.itheima.domain.Account;
import org.apache.commons.dbutils.QueryRunner;
import org.apache.commons.dbutils.handlers.BeanHandler;
import org.apache.commons.dbutils.handlers.BeanListHandler;
import org.junit.runner.Runner;

import java.util.List;

/**
 * 账户的持久层实现类
 */
public class AccountDaoImpl implements IAccountDao {

    private QueryRunner runner;

    public void setRunner(QueryRunner runner) {
        this.runner = runner;
    }

    public List&lt;Account&gt; findAllAccount() {
        try {
            return runner.query(&quot;select * from account&quot;, new BeanListHandler&lt;Account&gt;(Account.class));
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public Account findAccountById(Integer accountId) {
        try {
            return runner.query(&quot;select * from account where id = ? &quot;, new BeanHandler&lt;Account&gt;(Account.class), accountId);
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public void saveAccount(Account account) {
        try {
            runner.update(&quot;insert into account(name,money)values(?,?)&quot;, account.getName(), account.getMoney());
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public void updateAccount(Account account) {
        try {
            runner.update(&quot;update account set name=?,money=? where id=?&quot;, account.getName(), account.getMoney(), account.getId());
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public void deleteAccount(Integer accountId) {
        try {
            runner.update(&quot;delete from account where id=?&quot;, accountId);
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public Account findAccountByName(String accountName) {
        try {
             List&lt;Account&gt; accounts = runner.query(&quot;select * from account where name= ? &quot;, new BeanListHandler&lt;Account&gt;(Account.class), accountName);
            if(accounts == null || accounts.size()==0){
                return null;
            }
            if(accounts.size()&gt;1){
                throw new RuntimeException(&quot;结果不一致&quot;);
            }
            return accounts.get(0);
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }
}
</code></pre><hr>
<pre><code>package com.itheima.service;

import com.itheima.domain.Account;

import java.util.List;

/**
 * 账户的业务层接口
 */
public interface IAccountService {

    /**
     * 查询所有
     * @return
     */
    List&lt;Account&gt; findAllAccount();

    /**
     * 查询一个
     * @return
     */
    Account findAccountById(Integer accountId);

    /**
     * 保存
     * @param account
     */
    void saveAccount(Account account);

    /**
     * 更新
     * @param account
     */
    void updateAccount(Account account);

    /**
     * 删除
     * @param acccountId
     */
    void deleteAccount(Integer acccountId);

    /**
     *
     * 转账方法
     * @param sourceName    转出账户名称
     * @param targetName    转入账户名称
     * @param money         转账金额
     */
    void transfer(String sourceName,String targetName,Float money);
</code></pre><p>}</p>
<hr>
<pre><code>package com.itheima.service.impl;

import com.itheima.dao.IAccountDao;
import com.itheima.domain.Account;
import com.itheima.service.IAccountService;

import java.util.List;

/**
 * 账户的业务层实现类
 */
public class AccountServiceImpl implements IAccountService{

    private IAccountDao accountDao;

    public void setAccountDao(IAccountDao accountDao) {
        this.accountDao = accountDao;
    }

    public List&lt;Account&gt; findAllAccount() {
        return accountDao.findAllAccount();
    }

    public Account findAccountById(Integer accountId) {
        return accountDao.findAccountById(accountId);
    }

    public void saveAccount(Account account) {
        accountDao.saveAccount(account);
    }

    public void updateAccount(Account account) {
        accountDao.updateAccount(account);
    }

    public void deleteAccount(Integer acccountId) {
        accountDao.deleteAccount(acccountId);
    }

    public void transfer(String sourceName, String targetName, Float money) {
//        1、根据名称查询转出账户
        Account source = accountDao.findAccountByName(sourceName);
//        2、根据名称查询转入账户
        Account target = accountDao.findAccountByName(targetName);
//        3、转出账户减钱
        source.setMoney(source.getMoney()- money);
//        4、转入账户加钱
        target.setMoney(target.getMoney()+money);
//        5、更新转出账户
        accountDao.updateAccount(source);
//        6、更新转入账户
        accountDao.updateAccount(target);

    }
}
</code></pre><hr>
<p>bean.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;
    &lt;!-- 配置Service --&gt;
    &lt;bean id=&quot;accountService&quot; class=&quot;com.itheima.service.impl.AccountServiceImpl&quot;&gt;
        &lt;!-- 注入dao --&gt;
        &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!--配置Dao对象--&gt;
    &lt;bean id=&quot;accountDao&quot; class=&quot;com.itheima.dao.impl.AccountDaoImpl&quot;&gt;
        &lt;!-- 注入QueryRunner --&gt;
        &lt;property name=&quot;runner&quot; ref=&quot;runner&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!--配置QueryRunner--&gt;
    &lt;bean id=&quot;runner&quot; class=&quot;org.apache.commons.dbutils.QueryRunner&quot; scope=&quot;prototype&quot;&gt;
        &lt;!--注入数据源--&gt;
        &lt;constructor-arg name=&quot;ds&quot; ref=&quot;dataSource&quot;&gt;&lt;/constructor-arg&gt;
    &lt;/bean&gt;

    &lt;!-- 配置数据源 --&gt;
    &lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;
        &lt;!--连接数据库的必备信息--&gt;
        &lt;property name=&quot;driverClass&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/eesy?characterEncoding=utf8;useSSL=false;serverTimezone=UTCrewriteBatchedStatements=true&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;user&quot; value=&quot;root&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;root&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre><hr>
<pre><code>package com.itheima.test;

import com.itheima.domain.Account;
import com.itheima.service.IAccountService;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import java.util.List;

/**
 * 使用Junit单元测试：测试我们的配置
 */
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = &quot;classpath:bean.xml&quot;)
public class AccountServiceTest {

    @Autowired
    private  IAccountService as;

    @Test
    public void testTransfer(){
        as.transfer(&quot;aaa&quot;,&quot;bbb&quot;,100f);
    }
}
</code></pre><hr>
<p>但是如果说在serviceimpl里面加入了一个报错的语句，会导致钱转出了， 但是没有转入如下图所示：</p>
<p><img src="https://i.imgur.com/UOkubon.png" alt=""></p>
<p><img src="https://i.imgur.com/j07QJUW.png" alt=""></p>
<h2 id="怎么解决这个事务的问题？"><a href="#怎么解决这个事务的问题？" class="headerlink" title="怎么解决这个事务的问题？"></a>怎么解决这个事务的问题？</h2><p><img src="https://i.imgur.com/9mpJpJq.png" alt=""></p>
<p>基本上就是每次都是创建一个新的连接，每次都没有任何关系，所以我们要让他们都在一个连接之内，要发生就都发生，要不发生就都不发生。需要对代码进行一定调整。</p>
<p><strong>事务控制应该都在业务层</strong></p>
<p>改造代码：修改Service层的代码和bean.xml的注入文件：</p>
<pre><code>package com.itheima.service.impl;

import com.itheima.dao.IAccountDao;
import com.itheima.domain.Account;
import com.itheima.service.IAccountService;
import com.itheima.utils.TransactionManager;

import java.util.List;

/**
 * 账户的业务层实现类
 */
public class AccountServiceImpl implements IAccountService {

    private IAccountDao accountDao;
    private TransactionManager txManger;

    public void setTxManger(TransactionManager txManger) {
        this.txManger = txManger;
    }

    public void setAccountDao(IAccountDao accountDao) {
        this.accountDao = accountDao;
    }

    public List&lt;Account&gt; findAllAccount() {
        try {
//            1、开启事务，
            txManger.beginTransaction();
//            2、执行操作
            List&lt;Account&gt; accounts = accountDao.findAllAccount();
//            3、提交事务
            txManger.commit();
//            4、返回结果
            return accounts;
        } catch (Exception e) {
//             5、回滚操作
            txManger.rollback();
        } finally {
//             6、释放资源
            txManger.release();
        }
        return null;
    }

    public Account findAccountById(Integer accountId)
    {
        try {
//            1、开启事务，
            txManger.beginTransaction();
//            2、执行操作
            Account account = accountDao.findAccountById(accountId);
//            3、提交事务
            txManger.commit();
//            4、返回结果
            return account;
        } catch (Exception e) {
//             5、回滚操作
            txManger.rollback();
            throw new RuntimeException();
        } finally {
//             6、释放资源
            txManger.release();
        }
    }

    public void saveAccount(Account account) {
        try {
//            1、开启事务，
            txManger.beginTransaction();
//            2、执行操作
            accountDao.saveAccount(account);
//            3、提交事务
            txManger.commit();
//            4、返回结果
        } catch (Exception e) {
//             5、回滚操作
            txManger.rollback();
        } finally {
//             6、释放资源
            txManger.release();
        }
    }

    public void updateAccount(Account account) {
        try {
//            1、开启事务，
            txManger.beginTransaction();
//            2、执行操作
            accountDao.updateAccount(account);
//            3、提交事务
            txManger.commit();
//            4、返回结果
        } catch (Exception e) {
//             5、回滚操作
            txManger.rollback();
        } finally {
//             6、释放资源
            txManger.release();
        }
    }

    public void deleteAccount(Integer acccountId) {
        try {
//            1、开启事务，
            txManger.beginTransaction();
//            2、执行操作
            accountDao.deleteAccount(acccountId);
//            3、提交事务
            txManger.commit();
//            4、返回结果
        } catch (Exception e) {
//             5、回滚操作
            txManger.rollback();
        } finally {
//             6、释放资源
            txManger.release();
        }
    }

    public void transfer(String sourceName, String targetName, Float money) {

        try {
//            1、开启事务，
            txManger.beginTransaction();
//            2、执行操作
            //       b  1、根据名称查询转出账户
            Account source = accountDao.findAccountByName(sourceName);
//        2.1、根据名称查询转入账户
            Account target = accountDao.findAccountByName(targetName);
//        2.2、转出账户减钱
            source.setMoney(source.getMoney()- money);
//        2.3、转入账户加钱
            target.setMoney(target.getMoney()+money);
//        2.4、更新转出账户
            accountDao.updateAccount(source);
            int i = 1/0;
//        2.5、更新转入账户
            accountDao.updateAccount(target);
//            3、提交事务
            txManger.commit();
//            4、返回结果
        } catch (Exception e) {
//             5、回滚操作
            txManger.rollback();
        } finally {
//             6、释放资源
            txManger.release();
        }
    }
}
</code></pre><hr>
<p>bean.xml文件：</p>
<pre><code>    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;
    &lt;!-- 配置Service --&gt;
    &lt;bean id=&quot;accountService&quot; class=&quot;com.itheima.service.impl.AccountServiceImpl&quot;&gt;
        &lt;!-- 注入dao --&gt;
        &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;&gt;&lt;/property&gt;
        &lt;!--注入事务管理器--&gt;
        &lt;property name=&quot;txManger&quot; ref=&quot;txManager&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!--配置Dao对象--&gt;
    &lt;bean id=&quot;accountDao&quot; class=&quot;com.itheima.dao.impl.AccountDaoImpl&quot;&gt;
        &lt;!-- 注入QueryRunner --&gt;
        &lt;property name=&quot;runner&quot; ref=&quot;runner&quot;&gt;&lt;/property&gt;
&lt;!--        注入ConnectionUtils--&gt;
        &lt;property name=&quot;connectionUtils&quot; ref =&quot;connectionUtils&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!--配置QueryRunner--&gt;
    &lt;bean id=&quot;runner&quot; class=&quot;org.apache.commons.dbutils.QueryRunner&quot; scope=&quot;prototype&quot;&gt;
    &lt;/bean&gt;

    &lt;!-- 配置数据源 --&gt;
    &lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;
        &lt;!--连接数据库的必备信息--&gt;
        &lt;property name=&quot;driverClass&quot; value=&quot;com.mysql.jdbc.Driver&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/eesy?localhost:3306/eesy?characterEncoding=utf-8&amp;amp;serverTimezone=UTC&amp;amp;useSSL=false&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;user&quot; value=&quot;root&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;root&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

&lt;!--    配置Connection的工具类 ConnectionUtils--&gt;
    &lt;bean id =&quot;connectionUtils&quot; class =&quot;com.itheima.utils.ConnectionUtils&quot;&gt;
&lt;!--        注入数据源--&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

&lt;!--    配置事务管理器--&gt;
    &lt;bean id=&quot;txManager&quot; class=&quot;com.itheima.utils.TransactionManager&quot;&gt;
&lt;!--        注入ConnectionUtils--&gt;
        &lt;property name=&quot;connectionUtils&quot; ref=&quot;connectionUtils&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;     
</code></pre><hr>
<p>添加Connectionutils类：</p>
<pre><code>package com.itheima.utils;

import javax.sql.DataSource;
import java.sql.Connection;

/**
 * @Description 连接的工具类，用于从数据源中获取一个连接，并且实现和线程的绑定
 * @Author TT Hun
 * @Data 2019/10/3 11:22
 */
public class ConnectionUtils {

    private ThreadLocal&lt;Connection&gt; tl = new ThreadLocal&lt;Connection&gt;();
    private DataSource dataSource;


    public void setDataSource(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    /**
     * 获取当前线程上的链接
     *
     * @return
     */
    public Connection getThreadConnection() {
//        1、先从ThreadLocal上获取
        Connection conn = tl.get();
//        2、判断当前线程上是否有链接
        try {
            if (conn == null) {
//        3、从数据源中获取一个连接，并且存入ThreadLocalz中
                conn = dataSource.getConnection();
                tl.set(conn);
            }
//        4、返回当前线程上的连接
            return conn;
        } catch (Exception e) {
            throw new RuntimeException(&quot;报错了&quot;);
        }
    }

    /**
     * 链接和线程解绑
     */
    public void removeConnection(){
        tl.remove();
    }
}
</code></pre><p>添加TransactionManager类：</p>
<pre><code>package com.itheima.utils;

/**
 * @Description 和事务管理相关的工具类，包含了开启事务，提交事务，回滚事务和释放连接的方法
 * @Author TT Hun
 * @Data 2019/10/3 11:35
 */
public class TransactionManager {

    private ConnectionUtils connectionUtils;

    public void setConnectionUtils(ConnectionUtils connectionUtils) {
        this.connectionUtils = connectionUtils;
    }

    /**
     * 开始事务
     */
    public void beginTransaction() {
        try {
            connectionUtils.getThreadConnection().setAutoCommit(false);
        } catch (Exception e) {
            e.printStackTrace();
        }

    }

    /**
     * 提交事务
     */
    public void commit() {
        try {
            connectionUtils.getThreadConnection().commit();
        } catch (Exception e) {
            e.printStackTrace();
        }

    }

    /**
     * 回滚事务
     */
    public void rollback() {
        try {
            connectionUtils.getThreadConnection().rollback();
        } catch (Exception e) {
            e.printStackTrace();
        }

    }

    /**
     * 释放连接事务
     */
    public void release() {
        try {
//            使用服务器也有一个线程池，当tomcat启动时候，会初始化一大堆线程放到一个容器中
//            每次访问都是线程池中拿出来一个线程给我们使用，调用close方法并不是真正的关闭而是将线程还给线程池
            connectionUtils.getThreadConnection().close();
//            所以想要连接和线程解绑，通过这个方法。
            connectionUtils.removeConnection();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
</code></pre><hr>
<p>再使用test类测试：</p>
<pre><code>package com.itheima.test;

import com.itheima.domain.Account;
import com.itheima.service.IAccountService;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import java.util.List;

/**
 * 使用Junit单元测试：测试我们的配置
 */
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = &quot;classpath:bean.xml&quot;)
public class AccountServiceTest {

    @Autowired
    private  IAccountService as;

    @Test
    public void testTransfer(){
        as.transfer(&quot;aaa&quot;,&quot;bbb&quot;,100f); 
    }
}
</code></pre><hr>
<hr>
<hr>
<h1 id="基于接口的动态代理回顾"><a href="#基于接口的动态代理回顾" class="headerlink" title="基于接口的动态代理回顾"></a>基于接口的动态代理回顾</h1><pre><code>/**
 * @Description TODO
 * @Author TT Hun
 * @Data 2019/10/3 17:51
 */
public interface IProducer {


    public void saleProduct(float money) ;

    public void afterService(float money);

}
</code></pre><hr>
<pre><code>/**
 * @Description TODO
 * @Author TT Hun
 * @Data 2019/10/3 17:48
 */
public class Producer  implements IProducer{
    /**
     * 销售
     *
     * @param money
     */
    public void saleProduct(float money) {
        System.out.println(&quot;销售产品，并且拿到钱&quot; + money);

    }

    /**
     * 售后
     *
     * @param money
     */
    public void afterService(float money) {
        System.out.println(&quot;提供售后服务并拿到钱&quot; + money);
    }
}
</code></pre><hr>
<pre><code>import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Method;
import java.lang.reflect.Proxy;
import java.util.Properties;

/**
 * @Description 模拟一个消费者
 * @Author TT Hun
 * @Data 2019/10/3 17:52
 */
public class Client {
    public static void main(String[] args) {
        final Producer producer = new Producer();

        /**
         * 动态代理：
         *      特点：字节码随用随创建，随用随加载
         *      作用：不修改源码的基础上对方法进行增强
         *      分类：基于接口的动态代理
         *             基于子类的动态代理
         *
         *       基于接口的动态代理：涉及的类：Proxy
         *                           提供者：官方
         *
         *        如何创建爱代理对象：使用Porxy类中的newProxyInstance方法
         *        创建代理对象的要求：被代理类最少实现一个接口，如果没有则不能使用
         *
         *        newProxyInstance方法的参数;
         *        Classloader：用于加载代理对象字节码的。写的是被代理对象使用相同的类加载器。代理谁就写谁的classloader固定写法
         *        Class[]：是字节码数组，让代理对象和被代理对象有相同的方法。固定写法
         *        InvocationHandler：用于提供增强的代码。他是让我们写如何代理。我们一般都是写一个该接口的实现类，通常都是匿名内
         *        部类，但是不必须的。此接口的实现类都是谁用谁写，
         *
         */
         IProducer proxyProducer = (IProducer) Proxy.newProxyInstance(producer.getClass().getClassLoader(), producer.getClass().getInterfaces(), new InvocationHandler() {
             /**
              * 作用：执行被代理对象的任何接口方法都会经过该方法，该方法就会有拦截的功能
              * 方法参数的含义
              * @param proxy ：代理对象的引用
              * @param method： 表示当前执行的方法
              * @param args ：当前执行方法所需要的参数
              * @return     和被代理对象有相同的返回值
              * @throws Throwable
              * 内部类访问外部对象时候要求外部对象是final的
              */
            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
//                提供增强的代码
                Object returnValue = null;
//                1、获取方法执行的参数
                Float money = (Float)args[0];
//                2、判断当前方法是不是销售方法
                if(&quot;saleProduct&quot;.equals(method.getName())){
                   returnValue = method.invoke(producer,money*0.8f);
                }
                return returnValue;
            }
        });
         proxyProducer.saleProduct(10000f);
    }
}
</code></pre><hr>
<p><strong>上述有一个问题：如果类不实现任何接口的时候是不能使用的</strong></p>
<h1 id="基于子类的动态代理"><a href="#基于子类的动态代理" class="headerlink" title="基于子类的动态代理"></a>基于子类的动态代理</h1><p>要求有第三方jar包的支持 cglib包</p>
<pre><code>package com.itheima.cglib;

/**
 * @Description TODO
 * @Author TT Hun
 * @Data 2019/10/3 17:48
 */
public class Producer    {
    /**
     * 销售
     *
     * @param money
     */
    public void saleProduct(float money) {
        System.out.println(&quot;销售产品，并且拿到钱&quot; + money);

    }

    /**
     * 售后
     *
     * @param money
     */
    public void afterService(float money) {
        System.out.println(&quot;提供售后服务并拿到钱&quot; + money);
    }
}
</code></pre><hr>
<pre><code>package com.itheima.cglib;

import net.sf.cglib.proxy.Enhancer;
import net.sf.cglib.proxy.MethodInterceptor;
import net.sf.cglib.proxy.MethodProxy;

import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Method;
import java.lang.reflect.Proxy;

/**
 * @Description 模拟一个消费者
 * @Author TT Hun
 * @Data 2019/10/3 17:52
 */
public class Client {
    public static void main(String[] args) {
        final Producer producer = new Producer();

        /**
         * 动态代理：
         *      特点：字节码随用随创建，随用随加载
         *      作用：不修改源码的基础上对方法进行增强
         *      分类：基于接口的动态代理
         *             基于子类的动态代理
         *
         *       基于子类的动态代理：涉及的类：Enhancer
         *                           提供者：第三方cglib库
         *
         *        如何创建爱代理对象：使用Enhancer类中的create方法
         *        创建代理对象的要求：被代理不能是最终类
         *
         *        create方法的参数;
         *        class：字节码
         *              用于指定被代理对象的字节码。
         *         callback:用于提供增强的代码
         *                  他是让我们写如何代理，我们一般都是写改接口的子接口实现类：MethodInterceptor
         *
         */

       Producer cglibProducer = (Producer) Enhancer.create(producer.getClass(), new MethodInterceptor() {
//            执行被代理对象任何方法都会经过该方法

            /**
             *
             * @param o
             * @param method
             * @param args
             * 以上三个参数和基于接口的对象代理Invoke的代理参数是一样的
             * @param methodProxy：当前执行方法的代理对象
             * @return
             * @throws Throwable
             */
            public Object intercept(Object o, Method method, Object[] args, MethodProxy methodProxy) throws Throwable {
//                提供增强的代码
                Object returnValue = null;
//                1、获取方法执行的参数
                Float money = (Float) args[0];
//                2、判断当前方法是不是销售方法
                if (&quot;saleProduct&quot;.equals(method.getName())) {
                    returnValue = method.invoke(producer, money * 0.8f);
                }
                return returnValue;
            }
        });
       cglibProducer.saleProduct(12000f);
    }
}
</code></pre><hr>
<p>动态代理的作用：</p>
<pre><code>1、连接池那个地方就是close不能关闭连接，只能将线程放到线程池，可以通过动态代理解决对connection的close()方法进行增强。把它家回到池里面去。
2、解决全栈中文乱码的问题，对其中的3个方法进行增强。
</code></pre><p>下面一段代码是通过动态代理但是不通过AOP解决事务的问题、解决重复代码，解决了方法之间的依赖，但是导致配置文件bean.xml里面的配置比较繁琐。以下是标准的使用动态代理控制事务解决银行问题的代码，是标准代码，但是我自己由于数据库问题没有运行成功：</p>
<pre><code>package com.itheima.dao.impl;

import com.itheima.dao.IAccountDao;
import com.itheima.domain.Account;
import com.itheima.utils.ConnectionUtils;
import org.apache.commons.dbutils.QueryRunner;
import org.apache.commons.dbutils.handlers.BeanHandler;
import org.apache.commons.dbutils.handlers.BeanListHandler;

import java.util.List;

/**
 * 账户的持久层实现类
 */
public class AccountDaoImpl implements IAccountDao {

    private QueryRunner runner;
    private ConnectionUtils connectionUtils;

    public void setRunner(QueryRunner runner) {
        this.runner = runner;
    }

    public void setConnectionUtils(ConnectionUtils connectionUtils) {
        this.connectionUtils = connectionUtils;
    }

    public List&lt;Account&gt; findAllAccount() {
        try{
            return runner.query(connectionUtils.getThreadConnection(),&quot;select * from account&quot;,new BeanListHandler&lt;Account&gt;(Account.class));
        }catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public Account findAccountById(Integer accountId) {
        try{
            return runner.query(connectionUtils.getThreadConnection(),&quot;select * from account where id = ? &quot;,new BeanHandler&lt;Account&gt;(Account.class),accountId);
        }catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public void saveAccount(Account account) {
        try{
            runner.update(connectionUtils.getThreadConnection(),&quot;insert into account(name,money)values(?,?)&quot;,account.getName(),account.getMoney());
        }catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public void updateAccount(Account account) {
        try{
            runner.update(connectionUtils.getThreadConnection(),&quot;update account set name=?,money=? where id=?&quot;,account.getName(),account.getMoney(),account.getId());
        }catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public void deleteAccount(Integer accountId) {
        try{
            runner.update(connectionUtils.getThreadConnection(),&quot;delete from account where id=?&quot;,accountId);
        }catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public Account findAccountByName(String accountName) {
        try{
            List&lt;Account&gt; accounts = runner.query(connectionUtils.getThreadConnection(),&quot;select * from account where name = ? &quot;,new BeanListHandler&lt;Account&gt;(Account.class),accountName);
            if(accounts == null || accounts.size() == 0){
                return null;
            }
            if(accounts.size() &gt; 1){
                throw new RuntimeException(&quot;结果集不唯一，数据有问题&quot;);
            }
            return accounts.get(0);
        }catch (Exception e) {
            throw new RuntimeException(e);
        }
    }
}
</code></pre><hr>
<pre><code>package com.itheima.dao;

import com.itheima.domain.Account;

import java.util.List;

/**
 * 账户的持久层接口
 */
public interface IAccountDao {

    /**
     * 查询所有
     * @return
     */
    List&lt;Account&gt; findAllAccount();

    /**
     * 查询一个
     * @return
     */
    Account findAccountById(Integer accountId);

    /**
     * 保存
     * @param account
     */
    void saveAccount(Account account);

    /**
     * 更新
     * @param account
     */
    void updateAccount(Account account);

    /**
     * 删除
     * @param acccountId
     */
    void deleteAccount(Integer acccountId);

    /**
     * 根据名称查询账户
     * @param accountName
     * @return  如果有唯一的一个结果就返回，如果没有结果就返回null
     *          如果结果集超过一个就抛异常
     */
    Account findAccountByName(String accountName);
}
</code></pre><hr>
<pre><code>package com.itheima.domain;

import java.io.Serializable;

/**
 * 账户的实体类
 */
public class Account implements Serializable {

    private Integer id;
    private String name;
    private Float money;

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Float getMoney() {
        return money;
    }

    public void setMoney(Float money) {
        this.money = money;
    }

    @Override
    public String toString() {
        return &quot;Account{&quot; +
                &quot;id=&quot; + id +
                &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +
                &quot;, money=&quot; + money +
                &apos;}&apos;;
    }
}
</code></pre><hr>
<pre><code>package com.itheima.service.impl;

import com.itheima.dao.IAccountDao;
import com.itheima.domain.Account;
import com.itheima.service.IAccountService;

import java.util.List;

/**
 * 账户的业务层实现类
 *
 * 事务控制应该都是在业务层
 */
public class AccountServiceImpl implements IAccountService{

    private IAccountDao accountDao;

    public void setAccountDao(IAccountDao accountDao) {
        this.accountDao = accountDao;
    }

    @Override
    public List&lt;Account&gt; findAllAccount() {
       return accountDao.findAllAccount();
    }

    @Override
    public Account findAccountById(Integer accountId) {
        return accountDao.findAccountById(accountId);

    }

    @Override
    public void saveAccount(Account account) {
        accountDao.saveAccount(account);
    }

    @Override
    public void updateAccount(Account account) {
        accountDao.updateAccount(account);
    }

    @Override
    public void deleteAccount(Integer acccountId) {
        accountDao.deleteAccount(acccountId);
    }

    @Override
    public void transfer(String sourceName, String targetName, Float money) {
        System.out.println(&quot;transfer....&quot;);
            //2.1根据名称查询转出账户
            Account source = accountDao.findAccountByName(sourceName);
            //2.2根据名称查询转入账户
            Account target = accountDao.findAccountByName(targetName);
            //2.3转出账户减钱
            source.setMoney(source.getMoney()-money);
            //2.4转入账户加钱
            target.setMoney(target.getMoney()+money);
            //2.5更新转出账户
            accountDao.updateAccount(source);

//            int i=1/0;

            //2.6更新转入账户
            accountDao.updateAccount(target);
    }
}
</code></pre><hr>
<pre><code>package com.itheima.service;

import com.itheima.domain.Account;

import java.util.List;

/**
 * 账户的业务层接口
 */
public interface IAccountService {

    /**
     * 查询所有
     * @return
     */
    List&lt;Account&gt; findAllAccount();

    /**
     * 查询一个
     * @return
     */
    Account findAccountById(Integer accountId);

    /**
     * 保存
     * @param account
     */
    void saveAccount(Account account);

    /**
     * 更新
     * @param account
     */
    void updateAccount(Account account);

    /**
     * 删除
     * @param acccountId
     */
    void deleteAccount(Integer acccountId);

    /**
     * 转账
     * @param sourceName        转出账户名称
     * @param targetName        转入账户名称
     * @param money             转账金额
     */
    void transfer(String sourceName,String targetName,Float money);

    //void test();//它只是连接点，但不是切入点，因为没有被增强
}
</code></pre><hr>
<pre><code>package com.itheima.utils;

import javax.sql.DataSource;
import java.sql.Connection;

/**
 * 连接的工具类，它用于从数据源中获取一个连接，并且实现和线程的绑定
 */
public class ConnectionUtils {

    private ThreadLocal&lt;Connection&gt; tl = new ThreadLocal&lt;Connection&gt;();

    private DataSource dataSource;

    public void setDataSource(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    /**
     * 获取当前线程上的连接
     * @return
     */
    public Connection getThreadConnection() {
        try{
            //1.先从ThreadLocal上获取
            Connection conn = tl.get();
            //2.判断当前线程上是否有连接
            if (conn == null) {
                //3.从数据源中获取一个连接，并且存入ThreadLocal中
                conn = dataSource.getConnection();
                tl.set(conn);
            }
            //4.返回当前线程上的连接
            return conn;
        }catch (Exception e){
            throw new RuntimeException(e);
        }
    }

    /**
     * 把连接和线程解绑
     */
    public void removeConnection(){
        tl.remove();
    }
}
</code></pre><hr>
<pre><code>package com.itheima.utils;

/**
 * 和事务管理相关的工具类，它包含了，开启事务，提交事务，回滚事务和释放连接
 */
public class TransactionManager {

    private ConnectionUtils connectionUtils;

    public void setConnectionUtils(ConnectionUtils connectionUtils) {
        this.connectionUtils = connectionUtils;
    }

    /**
     * 开启事务
     */
    public  void beginTransaction(){
        try {
            connectionUtils.getThreadConnection().setAutoCommit(false);
        }catch (Exception e){
            e.printStackTrace();
        }
    }

    /**
     * 提交事务
     */
    public  void commit(){
        try {
            connectionUtils.getThreadConnection().commit();
        }catch (Exception e){
            e.printStackTrace();
        }
    }

    /**
     * 回滚事务
     */
    public  void rollback(){
        try {
            connectionUtils.getThreadConnection().rollback();
        }catch (Exception e){
            e.printStackTrace();
        }
    }


    /**
     * 释放连接
     */
    public  void release(){
        try {
            connectionUtils.getThreadConnection().close();//还回连接池中
            connectionUtils.removeConnection();
        }catch (Exception e){
            e.printStackTrace();
        }
    }
}
</code></pre><hr>
<pre><code>package com.itheima.factory;

import com.itheima.service.IAccountService;
import com.itheima.utils.TransactionManager;

import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Method;
import java.lang.reflect.Proxy;

/**
 * 用于创建Service的代理对象的工厂
 */
public class BeanFactory {

    private IAccountService accountService;

    private TransactionManager txManager;

    public void setTxManager(TransactionManager txManager) {
        this.txManager = txManager;
    }


    public final void setAccountService(IAccountService accountService) {
        this.accountService = accountService;
    }

    /**
     * 获取Service代理对象
     * @return
     */
    public IAccountService getAccountService() {
        return (IAccountService)Proxy.newProxyInstance(accountService.getClass().getClassLoader(),
                accountService.getClass().getInterfaces(),
                new InvocationHandler() {
                    /**
                     * 添加事务的支持
                     *
                     * @param proxy
                     * @param method
                     * @param args
                     * @return
                     * @throws Throwable
                     */
                    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {

//                        if(&quot;test&quot;.equals(method.getName())){
//                            return method.invoke(accountService,args);
//                        }
                        Object rtValue = null;
                        try {
                            //1.开启事务
                            txManager.beginTransaction();
                            //2.执行操作
                            rtValue = method.invoke(accountService, args);
                            //3.提交事务
                            txManager.commit();
                            //4.返回结果
                            return rtValue;
                        } catch (Exception e) {
                            //5.回滚操作
                            txManager.rollback();
                            throw new RuntimeException(e);
                        } finally {
                            //6.释放连接
                            txManager.release();
                        }
                    }
                });

    }
}
</code></pre><hr>
<p>bean.xml文件</p>
<pre><code>    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;

    &lt;!--配置代理的service--&gt;
    &lt;bean id=&quot;proxyAccountService&quot; factory-bean=&quot;beanFactory&quot; factory-method=&quot;getAccountService&quot;&gt;&lt;/bean&gt;

    &lt;!--配置beanfactory--&gt;
    &lt;bean id=&quot;beanFactory&quot; class=&quot;com.itheima.factory.BeanFactory&quot;&gt;
        &lt;!-- 注入service --&gt;
        &lt;property name=&quot;accountService&quot; ref=&quot;accountService&quot;&gt;&lt;/property&gt;
        &lt;!-- 注入事务管理器 --&gt;
        &lt;property name=&quot;txManager&quot; ref=&quot;txManager&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

     &lt;!-- 配置Service --&gt;
    &lt;bean id=&quot;accountService&quot; class=&quot;com.itheima.service.impl.AccountServiceImpl&quot;&gt;
        &lt;!-- 注入dao --&gt;
        &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!--配置Dao对象--&gt;
    &lt;bean id=&quot;accountDao&quot; class=&quot;com.itheima.dao.impl.AccountDaoImpl&quot;&gt;
        &lt;!-- 注入QueryRunner --&gt;
        &lt;property name=&quot;runner&quot; ref=&quot;runner&quot;&gt;&lt;/property&gt;
        &lt;!-- 注入ConnectionUtils --&gt;
        &lt;property name=&quot;connectionUtils&quot; ref=&quot;connectionUtils&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!--配置QueryRunner--&gt;
    &lt;bean id=&quot;runner&quot; class=&quot;org.apache.commons.dbutils.QueryRunner&quot; scope=&quot;prototype&quot;&gt;&lt;/bean&gt;

    &lt;!-- 配置数据源 --&gt;
    &lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;
        &lt;!--连接数据库的必备信息--&gt;
        &lt;property name=&quot;driverClass&quot; value=&quot;com.mysql.jdbc.Driver&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/eesy?characterEncoding=utf8&amp;amp;serverTimezone=UTC&amp;amp;useSSL=false&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;user&quot; value=&quot;root&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;password&quot; value=&quot;root&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!-- 配置Connection的工具类 ConnectionUtils --&gt;
    &lt;bean id=&quot;connectionUtils&quot; class=&quot;com.itheima.utils.ConnectionUtils&quot;&gt;
        &lt;!-- 注入数据源--&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!-- 配置事务管理器--&gt;
    &lt;bean id=&quot;txManager&quot; class=&quot;com.itheima.utils.TransactionManager&quot;&gt;
        &lt;!-- 注入ConnectionUtils --&gt;
        &lt;property name=&quot;connectionUtils&quot; ref=&quot;connectionUtils&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre><hr>
<pre><code>package com.itheima.test;

import com.itheima.service.IAccountService;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

/**
 * 使用Junit单元测试：测试我们的配置
 */
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = &quot;classpath:bean.xml&quot;)
public class AccountServiceTest {

    @Autowired
    @Qualifier(&quot;proxyAccountService&quot;)
    private  IAccountService as;

    @Test
    public  void testTransfer(){
        as.transfer(&quot;aaa&quot;,&quot;bbb&quot;,100f);
    }

}
</code></pre><hr>
<p>总结上述的代码；<br>utils.ConnectionUtils：获取当前线程上的连接，通过注入数据源、实例化ThreadLocal，通过ThreadLocal.get方法获取线程上的连接。<br>utils.TransactionManager:里面注入ConnectionUtils，然后写开启事务，提交事务，回滚事务，释放连接的方法<br>BeanFactory：注入Serviceimpl和TransactionManager。然后获取Service代理对象，通过getAccountService方法，并且在匿名内部类中添加事务。<br>然后在bean.xml文件里面写好要添加到各个地方的注入，然后配置代理的Service对象</p>
<pre><code>&lt;bean id = &quot;proxyAccountService&quot; factory-bean=&quot;beanFactory&quot; factory-method=&quot;getAccountService&quot;&gt; &lt;/bean&gt;
</code></pre><p>最后在test测试类中，添加注解@Qulifier因为在bean.xml文件中有2个都实现了IAccountService接口，所以要添加Qulifier注解<br><img src="https://i.imgur.com/qT2Rgb7.png" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://erichunn.github.io/2019/09/29/Spring第二天03Spring新注解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Eric Hunn">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="无心是一首歌">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/29/Spring第二天03Spring新注解/" itemprop="url">Spring第二天03Spring新注解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-29T19:34:41+08:00">
                2019-09-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          关于Spring新注解
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/09/29/Spring第二天03Spring新注解/">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/touxiang.jpg"
                alt="Eric Hunn" />
            
              <p class="site-author-name" itemprop="name">Eric Hunn</p>
              <p class="site-description motion-element" itemprop="description">大数据|动漫迷|科技控</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">78</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">116</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/erichunn" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:erichunn.me@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://weibo.com/u/2944687303/home?wvr=5" target="_blank" title="Webibo">
                      
                        <i class="fa fa-fw fa-weibo"></i>Webibo</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://github.com/drakeet/" title="Drakeet" target="_blank">Drakeet</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      
	  
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1311545319&auto=1&height=66"></iframe>

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Eric Hunn</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
